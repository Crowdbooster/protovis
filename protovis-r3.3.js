// 69d6cb1
Array.prototype.map||(Array.prototype.map=function(a,b){for(var c=this.length,d=Array(c),e=0;e<c;e++)e in this&&(d[e]=a.call(b,this[e],e,this));return d});Array.prototype.filter||(Array.prototype.filter=function(a,b){for(var c=this.length,d=[],e=0;e<c;e++)if(e in this){var f=this[e];a.call(b,f,e,this)&&d.push(f)}return d});Array.prototype.forEach||(Array.prototype.forEach=function(a,b){for(var c=this.length>>>0,d=0;d<c;d++)d in this&&a.call(b,this[d],d,this)});
Array.prototype.reduce||(Array.prototype.reduce=function(a,b){var c=this.length;if(!c&&1==arguments.length)throw Error("reduce: empty array, no initial value");var d=0;if(2>arguments.length)for(;;){if(d in this){b=this[d++];break}if(++d>=c)throw Error("reduce: no values, no initial value");}for(;d<c;d++)d in this&&(b=a(b,this[d],d,this));return b});
var pv={version:{major:3,minor:3,revision:4},identity:function(a){return a},index:function(){return this.index},child:function(){return this.childIndex},parent:function(){return this.parent.index},extend:function(a){function b(){}b.prototype=a.prototype||a;return new b}};
try{eval("pv.parse = function(x) x;")}catch(e$$10){pv.parse=function(a){for(var b=RegExp("function\\s*(\\b\\w+)?\\s*\\([^)]*\\)\\s*","mg"),c,d,e=0,f="";c=b.exec(a);){c=c.index+c[0].length;if("{"!=a.charAt(c)){for(var f=f+(a.substring(e,c)+"{return "),e=c,g=0;0<=g&&c<a.length;c++){var h=a.charAt(c);switch(h){case '"':case "'":for(;++c<a.length&&(d=a.charAt(c))!=h;)"\\"==d&&c++;break;case "[":case "(":g++;break;case "]":case ")":g--;break;case ";":case ",":0==g&&g--}}f+=pv.parse(a.substring(e,--c))+
";}";e=c}b.lastIndex=c}return f+=a.substring(e)}}pv.css=function(a,b){return window.getComputedStyle?window.getComputedStyle(a,null).getPropertyValue(b):a.currentStyle[b]};pv.error=function(a){"undefined"==typeof console?alert(a):console.error(a)};pv.listen=function(a,b,c){if("load"==b||"onload"==b)return pv.listenForPageLoad(pv.listener(c));c=pv.listener(c);return a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)};
pv.listener=function(a){return a.$listener||(a.$listener=function(b){try{return pv.event=b,a.call(this,b)}catch(c){pv.error(c)}finally{delete pv.event}})};pv.ancestor=function(a,b){for(;b;){if(b==a)return!0;b=b.parentNode}return!1};pv.scrollOffset=function(a){for(var b=0,c=0;a;)b+=a.scrollLeft||0,c+=a.scrollTop||0,a=a.parentNode;return[b,c]};
pv.listenForPageLoad=function(a){"complete"===document.readyState&&a();"svgweb"==pv.renderer()?window.addEventListener("SVGLoad",a,!1):document.addEventListener?window.addEventListener("load",a,!1):document.attachEvent&&window.attachEvent("onload",a)};pv.renderer=function(){return"undefined"!==typeof document.svgImplementation?document.svgImplementation:"undefined"===typeof window.svgweb?"nativesvg":"svgweb"};pv.id=function(){var a=1;return function(){return a++}}();
pv.functor=function(a){return"function"==typeof a?a:function(){return a}};pv.get=function(a,b,c){var d;return a&&null!=(d=a[b])?d:c};"batik"!==pv.renderer()&&pv.listen(window,"load",function(){pv.$={i:0,x:document.getElementsByTagName("script")};for(pv.$.xlen=pv.$.x.length;pv.$.i<pv.$.xlen;pv.$.i++)if(pv.$.s=pv.$.x[pv.$.i],"text/javascript+protovis"==pv.$.s.type)try{window.eval(pv.parse(pv.$.s.text))}catch(a){pv.error(a)}delete pv.$});pv.Format={};
pv.Format.re=function(a){return a.replace(/[\\\^\$\*\+\?\[\]\(\)\.\{\}]/g,"\\$&")};pv.Format.pad=function(a,b,c){b-=String(c).length;return 1>b?c:Array(b+1).join(a)+c};
pv.Format.date=function(a){function b(b){return a.replace(/%[a-zA-Z0-9]/g,function(a){switch(a){case "%a":return"Sun Mon Tue Wed Thu Fri Sat".split(" ")[b.getDay()];case "%A":return"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" ")[b.getDay()];case "%h":case "%b":return"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")[b.getMonth()];case "%B":return"January February March April May June July August September October November December".split(" ")[b.getMonth()];case "%c":return b.toLocaleString();
case "%C":return c("0",2,Math.floor(b.getFullYear()/100)%100);case "%d":return c("0",2,b.getDate());case "%x":case "%D":return c("0",2,b.getMonth()+1)+"/"+c("0",2,b.getDate())+"/"+c("0",2,b.getFullYear()%100);case "%e":return c(" ",2,b.getDate());case "%H":return c("0",2,b.getHours());case "%I":return(a=b.getHours()%12)?c("0",2,a):12;case "%m":return c("0",2,b.getMonth()+1);case "%M":return c("0",2,b.getMinutes());case "%n":return"\n";case "%p":return 12>b.getHours()?"AM":"PM";case "%T":case "%X":case "%r":return a=
b.getHours()%12,(a?c("0",2,a):12)+":"+c("0",2,b.getMinutes())+":"+c("0",2,b.getSeconds())+" "+(12>b.getHours()?"AM":"PM");case "%R":return c("0",2,b.getHours())+":"+c("0",2,b.getMinutes());case "%S":return c("0",2,b.getSeconds());case "%Q":return c("0",3,b.getMilliseconds());case "%t":return"\t";case "%u":return(a=b.getDay())?a:1;case "%w":return b.getDay();case "%y":return c("0",2,b.getFullYear()%100);case "%Y":return b.getFullYear();case "%%":return"%"}return a})}var c=pv.Format.pad;b.format=b;
b.parse=function(b){var c=1970,f=0,g=1,h=0,i=0,j=0,k=[function(){}],l=pv.Format.re(a).replace(/%[a-zA-Z0-9]/g,function(a){switch(a){case "%b":return k.push(function(a){f={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11}[a]}),"([A-Za-z]+)";case "%h":case "%B":return k.push(function(a){f={January:0,February:1,March:2,April:3,May:4,June:5,July:6,August:7,September:8,October:9,November:10,December:11}[a]}),"([A-Za-z]+)";case "%e":case "%d":return k.push(function(a){g=a}),"([0-9]+)";
case "%I":case "%H":return k.push(function(a){h=a}),"([0-9]+)";case "%m":return k.push(function(a){f=a-1}),"([0-9]+)";case "%M":return k.push(function(a){i=a}),"([0-9]+)";case "%p":return k.push(function(a){12==h?"am"==a&&(h=0):"pm"==a&&(h=Number(h)+12)}),"(am|pm)";case "%S":return k.push(function(a){j=a}),"([0-9]+)";case "%y":return k.push(function(a){a=Number(a);c=a+(0<=a&&69>a?2E3:69<=a&&100>a?1900:0)}),"([0-9]+)";case "%Y":return k.push(function(a){c=a}),"([0-9]+)";case "%%":return k.push(function(){}),
"%"}return a});(b=b.match(l))&&b.forEach(function(a,b){k[b](a)});return new Date(c,f,g,h,i,j)};return b};
pv.Format.time=function(a){function b(b){b=Number(b);switch(a){case "short":return 31536E6<=b?(b/31536E6).toFixed(1)+" years":6048E5<=b?(b/6048E5).toFixed(1)+" weeks":864E5<=b?(b/864E5).toFixed(1)+" days":36E5<=b?(b/36E5).toFixed(1)+" hours":6E4<=b?(b/6E4).toFixed(1)+" minutes":(b/1E3).toFixed(1)+" seconds";case "long":var e=[],f=b%36E5/6E4>>0;e.push(c("0",2,b%6E4/1E3>>0));if(36E5<=b){var g=b%864E5/36E5>>0;e.push(c("0",2,f));864E5<=b?(e.push(c("0",2,g)),e.push(Math.floor(b/864E5).toFixed())):e.push(g.toFixed())}else e.push(f.toFixed());
return e.reverse().join(":")}}var c=pv.Format.pad;b.format=b;b.parse=function(b){switch(a){case "short":for(var c=/([0-9,.]+)\s*([a-z]+)/g,f,g=0;f=c.exec(b);){var h=parseFloat(f[0].replace(",","")),i=0;switch(f[2].toLowerCase()){case "year":case "years":i=31536E6;break;case "week":case "weeks":i=6048E5;break;case "day":case "days":i=864E5;break;case "hour":case "hours":i=36E5;break;case "minute":case "minutes":i=6E4;break;case "second":case "seconds":i=1E3}g+=h*i}return g;case "long":return f=b.replace(",",
"").split(":").reverse(),g=0,f.length&&(g+=1E3*parseFloat(f[0])),1<f.length&&(g+=6E4*parseFloat(f[1])),2<f.length&&(g+=36E5*parseFloat(f[2])),3<f.length&&(g+=864E5*parseFloat(f[3])),g}};return b};
pv.Format.number=function(){function a(a){Infinity>f&&(a=Math.round(a*g)/g);if(x)return a=parseInt(a,10),-1E12>a&&a/1E12+" T"||-1E9>a&&a/1E9+" B"||-1E6>a&&a/1E6+" M"||-1E3>a&&a/1E3+"K"||1E3>a&&a||1E6>a&&a/1E3+" K"||1E9>a&&a/1E6+" M"||1E12>a&&a/1E9+" B"||1E15>a&&a/1E12+" T"||a;var u=String(Math.abs(a)).split("."),q=u[0];q.length>c&&(q=q.substring(q.length-c));j&&q.length<b&&(q=Array(b-q.length+1).join(h)+q);3<q.length&&(q=q.replace(/\B(?=(?:\d{3})+(?!\d))/g,l));!j&&q.length<d&&(q=Array(d-q.length+
1).join(h)+q);u[0]=0>a?m+q+s:q;a=u[1]||"";a.length<e&&(u[1]=a+Array(e-a.length+1).join(i));return u.join(k)}var b=0,c=Infinity,d=0,e=0,f=0,g=1,h="0",i="0",j=!0,k=".",l=",",m="âˆ’",s="",x=!1;a.format=a;a.parse=function(a){var b=pv.Format.re,a=String(a).split(k);1==a.length&&(a[1]="");a[0].replace(RegExp("^("+b(h)+")*"),"");a[1].replace(RegExp("("+b(i)+")*$"),"");b=a[0].replace(RegExp(b(l),"g"),"");b.length>c&&(b=b.substring(b.length-c));a=a[1]?Number("0."+a[1]):0;Infinity>f&&(a=Math.round(a*g)/g);return Math.round(b)+
a};a.integerDigits=function(a,e){return arguments.length?(b=Number(a),c=1<arguments.length?Number(e):b,d=b+Math.floor(b/3)*l.length,this):[b,c]};a.fractionDigits=function(a,b){return arguments.length?(e=Number(a),f=1<arguments.length?Number(b):e,g=Math.pow(10,f),this):[e,f]};a.integerPad=function(a){return arguments.length?(h=String(a),j=/\d/.test(h),this):h};a.fractionPad=function(a){return arguments.length?(i=String(a),this):i};a.decimal=function(a){return arguments.length?(k=String(a),this):k};
a.group=function(a){return arguments.length?(l=a?String(a):"",d=b+Math.floor(b/3)*l.length,this):l};a.bigNumbers=function(a){return arguments.length?(x=a,this):a};a.negativeAffix=function(a,b){return arguments.length?(m=String(a||""),s=String(b||""),this):[m,s]};return a};pv.map=function(a,b){var c={};return b?a.map(function(a,e){c.index=e;return b.call(c,a)}):a.slice()};pv.repeat=function(a,b){1==arguments.length&&(b=2);return pv.blend(pv.range(b).map(function(){return a}))};
pv.array=function(a,b){var c=0<=a?Array(a):[];if(void 0!==b)for(var d=0;d<a;d++)c[d]=b;return c};pv.cross=function(a,b){for(var c=[],d=0,e=a.length,f=b.length;d<e;d++)for(var g=0,h=a[d];g<f;g++)c.push([h,b[g]]);return c};pv.blend=function(a){return Array.prototype.concat.apply([],a)};
pv.transpose=function(a){var b=a.length,c=pv.max(a,function(a){return a.length});if(c>b){a.length=c;for(var d=b;d<c;d++)a[d]=Array(b);for(d=0;d<b;d++)for(var e=d+1;e<c;e++){var f=a[d][e];a[d][e]=a[e][d];a[e][d]=f}}else{for(d=0;d<c;d++)a[d].length=b;for(d=0;d<b;d++)for(e=0;e<d;e++)f=a[d][e],a[d][e]=a[e][d],a[e][d]=f}a.length=c;for(d=0;d<c;d++)a[d].length=b;return a};pv.normalize=function(a,b){for(var c=pv.map(a,b),d=pv.sum(c),e=0;e<c.length;e++)c[e]/=d;return c};
pv.permute=function(a,b,c){c||(c=pv.identity);var d=Array(b.length),e={};b.forEach(function(b,g){e.index=b;d[g]=c.call(e,a[b])});return d};pv.numerate=function(a,b){b||(b=pv.identity);var c={},d={};a.forEach(function(a,f){d.index=f;c[b.call(d,a)]=f});return c};pv.uniq=function(a,b){b||(b=pv.identity);var c={},d=[],e={},f;a.forEach(function(a,h){e.index=h;f=b.call(e,a);f in c||(c[f]=d.push(f))});return d};pv.naturalOrder=function(a,b){return a<b?-1:a>b?1:0};
pv.reverseOrder=function(a,b){return b<a?-1:b>a?1:0};pv.search=function(a,b,c){c||(c=pv.identity);for(var d=0,e=a.length-1;d<=e;){var f=d+e>>1,g=c(a[f]);if(g<b)d=f+1;else if(g>b)e=f-1;else return f}return-d-1};pv.search.index=function(a,b,c){a=pv.search(a,b,c);return 0>a?-a-1:a};
pv.range=function(a,b,c){1==arguments.length&&(b=a,a=0);void 0==c&&(c=1);if(Infinity==(b-a)/c)throw Error("range must be finite");var d=[],e=0,f,b=b-1E-10*(b-a);if(0>c)for(;(f=a+c*e++)>b;)d.push(f);else for(;(f=a+c*e++)<b;)d.push(f);return d};pv.random=function(a,b,c){1==arguments.length&&(b=a,a=0);void 0==c&&(c=1);return c?Math.floor(Math.random()*(b-a)/c)*c+a:Math.random()*(b-a)+a};
pv.sum=function(a,b){var c={};return a.reduce(b?function(a,e,f){c.index=f;return a+b.call(c,e)}:function(a,b){return a+b},0)};pv.max=function(a,b){return b==pv.index?a.length-1:Math.max.apply(null,b?pv.map(a,b):a)};pv.max.index=function(a,b){if(!a.length)return-1;if(b==pv.index)return a.length-1;b||(b=pv.identity);for(var c=0,d=-Infinity,e={},f=0;f<a.length;f++){e.index=f;var g=b.call(e,a[f]);g>d&&(d=g,c=f)}return c};pv.min=function(a,b){return b==pv.index?0:Math.min.apply(null,b?pv.map(a,b):a)};
pv.min.index=function(a,b){if(!a.length)return-1;if(b==pv.index)return 0;b||(b=pv.identity);for(var c=0,d=Infinity,e={},f=0;f<a.length;f++){e.index=f;var g=b.call(e,a[f]);g<d&&(d=g,c=f)}return c};pv.mean=function(a,b){return pv.sum(a,b)/a.length};pv.median=function(a,b){if(b==pv.index)return(a.length-1)/2;a=pv.map(a,b).sort(pv.naturalOrder);if(a.length%2)return a[Math.floor(a.length/2)];var c=a.length/2;return(a[c-1]+a[c])/2};
pv.variance=function(a,b){if(1>a.length)return NaN;if(1==a.length)return 0;var c=pv.mean(a,b),d=0,e={};b||(b=pv.identity);for(var f=0;f<a.length;f++){e.index=f;var g=b.call(e,a[f])-c,d=d+g*g}return d};pv.deviation=function(a,b){return Math.sqrt(pv.variance(a,b)/(a.length-1))};pv.log=function(a,b){return Math.log(a)/Math.log(b)};pv.logSymmetric=function(a,b){return 0==a?0:0>a?-pv.log(-a,b):pv.log(a,b)};
pv.logAdjusted=function(a,b){if(!isFinite(a))return a;var c=0>a;a<b&&(a+=(b-a)/b);return c?-pv.log(a,b):pv.log(a,b)};pv.logFloor=function(a,b){return 0<a?Math.pow(b,Math.floor(pv.log(a,b))):-Math.pow(b,-Math.floor(-pv.log(-a,b)))};pv.logCeil=function(a,b){return 0<a?Math.pow(b,Math.ceil(pv.log(a,b))):-Math.pow(b,-Math.ceil(-pv.log(-a,b)))};(function(){var a=Math.PI/180,b=180/Math.PI;pv.radians=function(b){return a*b};pv.degrees=function(a){return b*a}})();
pv.keys=function(a){var b=[],c;for(c in a)b.push(c);return b};pv.entries=function(a){var b=[],c;for(c in a)b.push({key:c,value:a[c]});return b};pv.values=function(a){var b=[],c;for(c in a)b.push(a[c]);return b};pv.dict=function(a,b){for(var c={},d={},e=0;e<a.length;e++)if(e in a){var f=a[e];d.index=e;c[f]=b.call(d,f)}return c};pv.dom=function(a){return new pv.Dom(a)};pv.Dom=function(a){this.$map=a};pv.Dom.prototype.$leaf=function(a){return"object"!=typeof a};
pv.Dom.prototype.leaf=function(a){return arguments.length?(this.$leaf=a,this):this.$leaf};pv.Dom.prototype.root=function(a){function b(a){var d=new pv.Dom.Node,g;for(g in a){var h=a[g];d.appendChild(c(h)?new pv.Dom.Node(h):b(h)).nodeName=g}return d}var c=this.$leaf,d=b(this.$map);d.nodeName=a;return d};pv.Dom.prototype.nodes=function(){return this.root().nodes()};pv.Dom.Node=function(a){this.nodeValue=a;this.childNodes=[]};pv.Dom.Node.prototype.parentNode=null;pv.Dom.Node.prototype.firstChild=null;
pv.Dom.Node.prototype.lastChild=null;pv.Dom.Node.prototype.previousSibling=null;pv.Dom.Node.prototype.nextSibling=null;
pv.Dom.Node.prototype.removeChild=function(a){var b=this.childNodes.indexOf(a);if(-1==b)throw Error("child not found");this.childNodes.splice(b,1);a.previousSibling?a.previousSibling.nextSibling=a.nextSibling:this.firstChild=a.nextSibling;a.nextSibling?a.nextSibling.previousSibling=a.previousSibling:this.lastChild=a.previousSibling;delete a.nextSibling;delete a.previousSibling;delete a.parentNode;return a};
pv.Dom.Node.prototype.appendChild=function(a){a.parentNode&&a.parentNode.removeChild(a);a.parentNode=this;(a.previousSibling=this.lastChild)?this.lastChild.nextSibling=a:this.firstChild=a;this.lastChild=a;this.childNodes.push(a);return a};
pv.Dom.Node.prototype.insertBefore=function(a,b){if(!b)return this.appendChild(a);var c=this.childNodes.indexOf(b);if(-1==c)throw Error("child not found");a.parentNode&&a.parentNode.removeChild(a);a.parentNode=this;a.nextSibling=b;(a.previousSibling=b.previousSibling)?b.previousSibling.nextSibling=a:(b==this.lastChild&&(this.lastChild=a),this.firstChild=a);this.childNodes.splice(c,0,a);return a};
pv.Dom.Node.prototype.replaceChild=function(a,b){var c=this.childNodes.indexOf(b);if(-1==c)throw Error("child not found");a.parentNode&&a.parentNode.removeChild(a);a.parentNode=this;a.nextSibling=b.nextSibling;(a.previousSibling=b.previousSibling)?b.previousSibling.nextSibling=a:this.firstChild=a;b.nextSibling?b.nextSibling.previousSibling=a:this.lastChild=a;this.childNodes[c]=a;return b};
pv.Dom.Node.prototype.visitBefore=function(a){function b(c,d){a(c,d);for(var e=c.firstChild;e;e=e.nextSibling)b(e,d+1)}b(this,0)};pv.Dom.Node.prototype.visitAfter=function(a){function b(c,d){for(var e=c.firstChild;e;e=e.nextSibling)b(e,d+1);a(c,d)}b(this,0)};
pv.Dom.Node.prototype.sort=function(a){if(this.firstChild){this.childNodes.sort(a);var b=this.firstChild=this.childNodes[0],c;delete b.previousSibling;for(var d=1;d<this.childNodes.length;d++)b.sort(a),c=this.childNodes[d],c.previousSibling=b,b=b.nextSibling=c;this.lastChild=b;delete b.nextSibling;b.sort(a)}return this};
pv.Dom.Node.prototype.reverse=function(){var a=[];this.visitAfter(function(b){for(;b.lastChild;)a.push(b.removeChild(b.lastChild));for(var c;c=a.pop();)b.insertBefore(c,b.firstChild)});return this};pv.Dom.Node.prototype.nodes=function(){function a(c){b.push(c);c.childNodes.forEach(a)}var b=[];a(this,b);return b};
pv.Dom.Node.prototype.toggle=function(a){if(a)return this.toggled?this.visitBefore(function(a){a.toggled&&a.toggle()}):this.visitAfter(function(a){a.toggled||a.toggle()});if(this.toggled){for(;a=this.toggled.pop();)this.appendChild(a);delete this.toggled}else if(this.lastChild)for(this.toggled=[];this.lastChild;)this.toggled.push(this.removeChild(this.lastChild))};pv.nodes=function(a){for(var b=new pv.Dom.Node,c=0;c<a.length;c++)b.appendChild(new pv.Dom.Node(a[c]));return b.nodes()};pv.tree=function(a){return new pv.Tree(a)};
pv.Tree=function(a){this.array=a};pv.Tree.prototype.keys=function(a){this.k=a;return this};pv.Tree.prototype.value=function(a){this.v=a;return this};pv.Tree.prototype.map=function(){for(var a={},b={},c=0;c<this.array.length;c++){b.index=c;for(var d=this.array[c],e=this.k.call(b,d),f=a,g=0;g<e.length-1;g++)f=f[e[g]]||(f[e[g]]={});f[e[g]]=this.v?this.v.call(b,d):d}return a};pv.nest=function(a){return new pv.Nest(a)};pv.Nest=function(a){this.array=a;this.keys=[]};
pv.Nest.prototype.key=function(a){this.keys.push(a);return this};pv.Nest.prototype.sortKeys=function(a){this.keys[this.keys.length-1].order=a||pv.naturalOrder;return this};pv.Nest.prototype.sortValues=function(a){this.order=a||pv.naturalOrder;return this};
pv.Nest.prototype.map=function(){for(var a={},b=[],c,d=0;d<this.array.length;d++){var e=this.array[d],f=a;for(c=0;c<this.keys.length-1;c++){var g=this.keys[c](e);f[g]||(f[g]={});f=f[g]}g=this.keys[c](e);f[g]||(c=[],b.push(c),f[g]=c);f[g].push(e)}if(this.order)for(c=0;c<b.length;c++)b[c].sort(this.order);return a};
pv.Nest.prototype.entries=function(){function a(b){var d=[],e;for(e in b){var f=b[e];d.push({key:e,values:f instanceof Array?f:a(f)})}return d}function b(a,d){var e=this.keys[d].order;e&&a.sort(function(a,b){return e(a.key,b.key)});if(++d<this.keys.length)for(var f=0;f<a.length;f++)b.call(this,a[f].values,d);return a}return b.call(this,a(this.map()),0)};pv.Nest.prototype.rollup=function(a){function b(c){for(var d in c){var e=c[d];e instanceof Array?c[d]=a(e):b(e)}return c}return b(this.map())};
pv.flatten=function(a){return new pv.Flatten(a)};pv.Flatten=function(a){this.map=a;this.keys=[]};pv.Flatten.prototype.key=function(a,b){this.keys.push({name:a,value:b});delete this.$leaf;return this};pv.Flatten.prototype.leaf=function(a){this.keys.length=0;this.$leaf=a;return this};
pv.Flatten.prototype.array=function(){function a(e,f){if(f<d.length-1)for(var i in e)c.push(i),a(e[i],f+1),c.pop();else b.push(c.concat(e))}var b=[],c=[],d=this.keys,e=this.$leaf;if(e){var f=function(a,d){if(e(a))b.push({keys:c.slice(),value:a});else for(var i in a)c.push(i),f(a[i],d+1),c.pop()};f(this.map,0);return b}a(this.map,0);return b.map(function(a){for(var b={},c=0;c<d.length;c++){var e=d[c],f=a[c];b[e.name]=e.value?e.value.call(null,f):f}return b})};
pv.vector=function(a,b){return new pv.Vector(a,b)};pv.Vector=function(a,b){this.x=a;this.y=b};pv.Vector.prototype.perp=function(){return new pv.Vector(-this.y,this.x)};pv.Vector.prototype.rotate=function(a){var b=Math.cos(a),a=Math.sin(a);return new pv.Vector(b*this.x-a*this.y,a*this.x+b*this.y)};pv.Vector.prototype.norm=function(){var a=this.length();return this.times(a?1/a:1)};pv.Vector.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};
pv.Vector.prototype.times=function(a){return new pv.Vector(this.x*a,this.y*a)};pv.Vector.prototype.plus=function(a,b){return 1==arguments.length?new pv.Vector(this.x+a.x,this.y+a.y):new pv.Vector(this.x+a,this.y+b)};pv.Vector.prototype.minus=function(a,b){return 1==arguments.length?new pv.Vector(this.x-a.x,this.y-a.y):new pv.Vector(this.x-a,this.y-b)};pv.Vector.prototype.dot=function(a,b){return 1==arguments.length?this.x*a.x+this.y*a.y:this.x*a+this.y*b};pv.Transform=function(){};
pv.Transform.prototype={k:1,x:0,y:0};pv.Transform.identity=new pv.Transform;pv.Transform.prototype.translate=function(a,b){var c=new pv.Transform;c.k=this.k;c.x=this.k*a+this.x;c.y=this.k*b+this.y;return c};pv.Transform.prototype.scale=function(a){var b=new pv.Transform;b.k=this.k*a;b.x=this.x;b.y=this.y;return b};pv.Transform.prototype.invert=function(){var a=new pv.Transform,b=1/this.k;a.k=b;a.x=-this.x*b;a.y=-this.y*b;return a};
pv.Transform.prototype.times=function(a){var b=new pv.Transform;b.k=this.k*a.k;b.x=this.k*a.x+this.x;b.y=this.k*a.y+this.y;return b};pv.Scale=function(){};
pv.Scale.interpolator=function(a,b){if("number"==typeof a)return function(c){return c*(b-a)+a};a=pv.color(a).rgb();b=pv.color(b).rgb();return function(c){var d=a.a*(1-c)+b.a*c;1E-5>d&&(d=0);return 0==a.a?pv.rgb(b.r,b.g,b.b,d):0==b.a?pv.rgb(a.r,a.g,a.b,d):pv.rgb(Math.round(a.r*(1-c)+b.r*c),Math.round(a.g*(1-c)+b.g*c),Math.round(a.b*(1-c)+b.b*c),d)}};
pv.Scale.quantitative=function(){function a(a){return new Date(a)}function b(a){var b=pv.search(c,a);0>b&&(b=-b-2);b=Math.max(0,Math.min(f.length-1,b));return f[b]((i(a)-d[b])/(d[b+1]-d[b]))}var c=[0,1],d=[0,1],e=[0,1],f=[pv.identity],g=Number,h=!1,i=pv.identity,j=pv.identity,k=String,l=null,m,s;b.transform=function(a,b){i=function(b){return h?-a(-b):a(b)};j=function(a){return h?-b(-a):b(a)};d=c.map(i);return this};b.domain=function(b,e,f){if(arguments.length){var j;b instanceof Array?(2>arguments.length&&
(e=pv.identity),3>arguments.length&&(f=e),j=b.length&&e(b[0]),c=b.length?[pv.min(b,e),pv.max(b,f)]:[]):(j=b,c=Array.prototype.slice.call(arguments).map(Number));c.length?1==c.length&&(c=[c[0],c[0]]):c=[-Infinity,Infinity];h=0>(c[0]||c[c.length-1]);d=c.map(i);g=j instanceof Date?a:Number;return this}return c.map(g)};b.range=function(){if(arguments.length){e=Array.prototype.slice.call(arguments);e.length?1==e.length&&(e=[e[0],e[0]]):e=[-Infinity,Infinity];f=[];for(var a=0;a<e.length-1;a++)f.push(pv.Scale.interpolator(e[a],
e[a+1]));return this}return e};b.invert=function(a){var b=pv.search(e,a);0>b&&(b=-b-2);b=Math.max(0,Math.min(f.length-1,b));return g(j(d[b]+(a-e[b])/(e[b+1]-e[b])*(d[b+1]-d[b])))};b.ticks=function(b,d){var e=c[0],f=c[c.length-1],h=f<e,i=h?f:e,f=h?e:f,e=f-i;if(!e||!isFinite(e))return g==a&&(k=pv.Format.date("%x")),[g(i)];if(g==a){var j,l,t,r=1;15768E7<=e?(j=31536E6,l="%Y",t=function(a){a.setFullYear(a.getFullYear()+r)}):1296E7<=e?(j=2592E6,l="%m/%Y",t=function(a){a.setMonth(a.getMonth()+r)}):3024E6<=
e?(j=6048E5,l="%m/%d",t=function(a){a.setDate(a.getDate()+7*r)}):432E6<=e?(j=864E5,l="%m/%d",t=function(a){a.setDate(a.getDate()+r)}):18E6<=e?(j=36E5,l="%I:%M %p",t=function(a){a.setHours(a.getHours()+r)}):3E5<=e?(j=6E4,l="%I:%M %p",t=function(a){a.setMinutes(a.getMinutes()+r)}):5E3<=e?(j=1E3,l="%I:%M:%S",t=function(a){a.setSeconds(a.getSeconds()+r)}):(j=1,l="%S.%Qs",t=function(a){a.setTime(a.getTime()+r)});j=s?s:j;l=m?m:l;k=pv.Format.date(l);i=new Date(i);l=[];var z=j;switch(z){case 31536E6:i.setMonth(0);
case 2592E6:i.setDate(1);case 6048E5:6048E5==z&&i.setDate(i.getDate()-i.getDay());case 864E5:i.setHours(0);case 36E5:i.setMinutes(0);case 6E4:i.setSeconds(0);case 1E3:i.setMilliseconds(0)}e/=j;if(10<e)switch(j){case 36E5:r=20<e?6:3;i.setHours(Math.floor(i.getHours()/r)*r);break;case 2592E6:r=24<e?3:12<e?2:1;i.setMonth(Math.floor(i.getMonth()/r)*r);break;case 6048E5:r=15<e?3:10<e?2:1;i.setDate(Math.floor(i.getDate()/(7*r))*7*r);break;case 864E5:r=30<=e?5:15<=e?3:2;i.setDate(Math.floor(i.getDate()/
r)*r);break;case 6E4:r=30<e?15:15<e?10:5;i.setMinutes(Math.floor(i.getMinutes()/r)*r);break;case 1E3:r=90<e?15:60<e?10:5;i.setSeconds(Math.floor(i.getSeconds()/r)*r);break;case 1:r=1E3<e?250:200<e?100:100<e?50:50<e?25:5;i.setMilliseconds(Math.floor(i.getMilliseconds()/r)*r);break;default:r=pv.logCeil(e/15,10),2>e/r?r/=5:5>e/r&&(r/=2),i.setFullYear(Math.floor(i.getFullYear()/r)*r)}s&&(r=1,t=function(a){a.setSeconds(a.getSeconds()+r*s/1E3)});for(;;){t(i);if(i>f)break;l.push(new Date(i))}return h?l.reverse():
l}null==b&&(b=10);j=pv.get(d,"roundInside",!0);t=pv.get(d,"numberExponentMin",-Infinity);l=pv.get(d,"numberExponentMax",Infinity);var z=pv.get(d,"prettyFormatBigNumbers",!1),A=pv.get(d,"onlyPositiveTicks",!1),B=Math.floor(pv.log(e/b,10)),D=!1;B>l?(B=l,D=!0):B<t&&(B=t,D=!0);r=Math.pow(10,B);e=b/(e/r);0.15>=e&&B<l-1?r*=10:0.35>=e?r*=5:0.75>=e&&(r*=2);B=Math.floor(pv.log(r,10)+1E-10);e=r*Math[j?"ceil":"floor"](i/r);f=r*Math[j?"floor":"ceil"](f/r);A&&(e=Math.max(0,e));k=pv.Format.number().fractionDigits(Math.max(0,
-B));f=pv.range(e,f+r,r);h&&f.reverse();z&&(k=pv.Format.number().bigNumbers(!0));f.roundInside=j;f.step=r;f.exponent=B;f.exponentOverflow=D;f.exponentMin=t;f.exponentMax=l;return f};b.dateTickFormat=function(){return arguments.length?(m=arguments[0],this):m};b.dateTickPrecision=function(){return arguments.length?(s=arguments[0],this):s};b.tickFormatter=function(a){return arguments.length?(l=a,this):l};b.tickFormat=function(a){return(l||k)(a)};b.nice=function(){if(2!=c.length)return this;var a=c[0],
b=c[c.length-1],e=b<a,f=e?b:a,a=e?a:b,b=a-f;if(!b||!isFinite(b))return this;b=Math.pow(10,Math.round(Math.log(b)/Math.log(10))-1);c=[Math.floor(f/b)*b,Math.ceil(a/b)*b];e&&c.reverse();d=c.map(i);return this};b.by=function(a){function c(){return b(a.apply(this,arguments))}for(var d in b)c[d]=b[d];return c};b.domain.apply(b,arguments);return b};pv.Scale.linear=function(){var a=pv.Scale.quantitative();a.domain.apply(a,arguments);return a};
pv.Scale.log=function(){var a=pv.Scale.quantitative(1,10),b,c,d=function(a){return Math.log(a)/c},e=function(a){return Math.pow(b,a)};a.ticks=function(){var c=a.domain(),g=0>c[0],h=Math.floor(g?-d(-c[0]):d(c[0])),i=Math.ceil(g?-d(-c[1]):d(c[1])),j=[];if(g)for(j.push(-e(-h));h++<i;)for(g=b-1;0<g;g--)j.push(-e(-h)*g);else{for(;h<i;h++)for(g=1;g<b;g++)j.push(e(h)*g);j.push(e(h))}for(h=0;j[h]<c[0];h++);for(i=j.length;j[i-1]>c[1];i--);return j.slice(h,i)};a.tickFormat=function(a){return a.toPrecision(1)};
a.nice=function(){var c=a.domain();return a.domain(pv.logFloor(c[0],b),pv.logCeil(c[1],b))};a.base=function(f){return arguments.length?(b=Number(f),c=Math.log(b),a.transform(d,e),this):b};a.domain.apply(a,arguments);return a.base(10)};pv.Scale.root=function(){var a=pv.Scale.quantitative();a.power=function(b){if(arguments.length){var c=Number(b),d=1/c;a.transform(function(a){return Math.pow(a,d)},function(a){return Math.pow(a,c)});return this}return c};a.domain.apply(a,arguments);return a.power(2)};
pv.Scale.ordinal=function(){function a(a){a in c||(c[a]=b.push(a)-1);return d[c[a]%d.length]}var b=[],c={},d=[];a.domain=function(a,d){if(arguments.length){a=a instanceof Array?1<arguments.length?pv.map(a,d):a:Array.prototype.slice.call(arguments);b=[];for(var g={},h=0;h<a.length;h++){var i=a[h];i in g||(g[i]=!0,b.push(i))}c=pv.numerate(b);return this}return b};a.range=function(a,b){return arguments.length?(d=a instanceof Array?1<arguments.length?pv.map(a,b):a:Array.prototype.slice.call(arguments),
"string"==typeof d[0]&&(d=d.map(pv.color)),this):d};a.split=function(a,b){var c=b-a,h=this.domain().length,i=0;0===c?d=pv.array(h,a):h&&(i=(b-a)/h,d=pv.range(a+i/2,b,i));d.step=i;return this};a.splitBandedCenter=function(b,c,g){a.split(b,c);null==g&&(g=1);d.band=d.step*g;d.margin=d.step-d.band;return this};a.splitBandedFlushCenter=function(a,b,c){null==c&&(c=1);var h=b-a,i=this.domain().length,j=0,k=0,l=0;0===h?d=pv.array(i,a):i&&(k=h*c/i,l=1<i?(h-i*k)/(i-1):0,j=l+k,d=pv.range(a+k/2,b,j));d.step=
j;d.band=k;d.margin=l;return this};a.splitFlush=function(a,b){var c=this.domain().length,h=(b-a)/(c-1);d=1==c?[(a+b)/2]:pv.range(a,b+h/2,h);return this};a.splitBanded=function(a,b,c){3>arguments.length&&(c=1);if(0>c){var h=this.domain().length,h=(b-a- -c*h)/(h+1);d=pv.range(a+h,b,h-c);d.band=-c}else h=(b-a)/(this.domain().length+(1-c)),d=pv.range(a+h*(1-c),b,h),d.band=h*c,d.step=h,d.margin=h-d.band;return this};a.by=function(b){function c(){return a(b.apply(this,arguments))}for(var d in a)c[d]=a[d];
return c};a.domain.apply(a,arguments);return a};
pv.Scale.quantile=function(){function a(a){return f(Math.max(0,Math.min(c,pv.search.index(d,a)-1))/c)}var b=-1,c=-1,d=[],e=[],f=pv.Scale.linear();a.quantiles=function(a){if(arguments.length){b=Number(a);if(0>b)d=[e[0]].concat(e),c=e.length-1;else{d=[];d[0]=e[0];for(var f=1;f<=b;f++)d[f]=e[~~(f*(e.length-1)/b)];c=b-1}return this}return d};a.domain=function(c,d){return arguments.length?(e=c instanceof Array?pv.map(c,d):Array.prototype.slice.call(arguments),e.sort(pv.naturalOrder),a.quantiles(b),this):
e};a.range=function(){return arguments.length?(f.range.apply(f,arguments),this):f.range()};a.by=function(b){function c(){return a(b.apply(this,arguments))}for(var d in a)c[d]=a[d];return c};a.domain.apply(a,arguments);return a};
pv.histogram=function(a,b){var c=!0;return{bins:function(d){var e=pv.map(a,b),f=[];arguments.length||(d=pv.Scale.linear(e).ticks());for(var g=0;g<d.length-1;g++){var h=f[g]=[];h.x=d[g];h.dx=d[g+1]-d[g];h.y=0}for(g=0;g<e.length;g++)h=pv.search.index(d,e[g])-1,h=f[Math.max(0,Math.min(f.length-1,h))],h.y++,h.push(a[g]);if(!c)for(g=0;g<f.length;g++)f[g].y/=e.length;return f},frequency:function(a){return arguments.length?(c=Boolean(a),this):c}}};
pv.color=function(a){if(a.rgb)return a.rgb();var b=/([a-z]+)\((.*)\)/i.exec(a);if(b){var c=b[2].split(","),d=1;switch(b[1]){case "hsla":case "rgba":if(d=parseFloat(c[3]),!d)return pv.Color.transparent}switch(b[1]){case "hsla":case "hsl":var e=parseFloat(c[0]),f=parseFloat(c[1])/100,c=parseFloat(c[2])/100;return(new pv.Color.Hsl(e,f,c,d)).rgb();case "rgba":case "rgb":var a=function(a){var b=parseFloat(a);return"%"==a[a.length-1]?Math.round(2.55*b):b},e=a(c[0]),f=a(c[1]),g=a(c[2]);return pv.rgb(e,f,
g,d)}}return(d=pv.Color.names[a])?d:"#"==a.charAt(0)?(4==a.length?(e=a.charAt(1),e+=e,f=a.charAt(2),f+=f,g=a.charAt(3),g+=g):7==a.length&&(e=a.substring(1,3),f=a.substring(3,5),g=a.substring(5,7)),pv.rgb(parseInt(e,16),parseInt(f,16),parseInt(g,16),1)):new pv.Color(a,1)};pv.Color=function(a,b){this.color=a;this.opacity=b};pv.Color.prototype.hsl=function(){return this.rgb().hsl()};pv.Color.prototype.brighter=function(a){return this.rgb().brighter(a)};pv.Color.prototype.darker=function(a){return this.rgb().darker(a)};
pv.rgb=function(a,b,c,d){return new pv.Color.Rgb(a,b,c,4==arguments.length?d:1)};pv.Color.Rgb=function(a,b,c,d){pv.Color.call(this,d?"rgb("+a+","+b+","+c+")":"none",d);this.r=a;this.g=b;this.b=c;this.a=d};pv.Color.Rgb.prototype=pv.extend(pv.Color);pv.Color.Rgb.prototype.red=function(a){return pv.rgb(a,this.g,this.b,this.a)};pv.Color.Rgb.prototype.green=function(a){return pv.rgb(this.r,a,this.b,this.a)};pv.Color.Rgb.prototype.blue=function(a){return pv.rgb(this.r,this.g,a,this.a)};
pv.Color.Rgb.prototype.alpha=function(a){return pv.rgb(this.r,this.g,this.b,a)};pv.Color.Rgb.prototype.rgb=function(){return this};pv.Color.Rgb.prototype.brighter=function(a){var a=Math.pow(0.7,arguments.length?a:1),b=this.r,c=this.g,d=this.b;if(!b&&!c&&!d)return pv.rgb(30,30,30,this.a);b&&30>b&&(b=30);c&&30>c&&(c=30);d&&30>d&&(d=30);return pv.rgb(Math.min(255,Math.floor(b/a)),Math.min(255,Math.floor(c/a)),Math.min(255,Math.floor(d/a)),this.a)};
pv.Color.Rgb.prototype.darker=function(a){a=Math.pow(0.7,arguments.length?a:1);return pv.rgb(Math.max(0,Math.floor(a*this.r)),Math.max(0,Math.floor(a*this.g)),Math.max(0,Math.floor(a*this.b)),this.a)};
pv.Color.Rgb.prototype.hsl=function(){var a=this.r/255,b=this.g/255,c=this.b/255,d=Math.max(a,b,c),e=Math.min(a,b,c),f=(d+e)/2,g;if(d===e)g=e=0;else{var h=d-e,e=0.5<f?h/(2-d-e):h/(d+e);switch(d){case a:g=(b-c)/h+(b<c?6:0);break;case b:g=(c-a)/h+2;break;case c:g=(a-b)/h+4}g/=6}return pv.hsl(360*g,e,f,this.a)};pv.hsl=function(a,b,c,d){return new pv.Color.Hsl(a,b,c,4==arguments.length?d:1)};
pv.Color.Hsl=function(a,b,c,d){pv.Color.call(this,"hsl("+a+","+100*b+"%,"+100*c+"%)",d);this.h=a;this.s=b;this.l=c;this.a=d};pv.Color.Hsl.prototype=pv.extend(pv.Color);pv.Color.Hsl.prototype.hsl=function(){return this};pv.Color.Hsl.prototype.hue=function(a){return pv.hsl(a,this.s,this.l,this.a)};pv.Color.Hsl.prototype.saturation=function(a){return pv.hsl(this.h,a,this.l,this.a)};pv.Color.Hsl.prototype.lightness=function(a){return pv.hsl(this.h,this.s,a,this.a)};
pv.Color.Hsl.prototype.alpha=function(a){return pv.hsl(this.h,this.s,this.l,a)};pv.Color.Hsl.prototype.rgb=function(){function a(a){360<a?a-=360:0>a&&(a+=360);return 60>a?f+(e-f)*a/60:180>a?e:240>a?f+(e-f)*(240-a)/60:f}var b=this.h,c=this.s,d=this.l,b=b%360;0>b&&(b+=360);var c=Math.max(0,Math.min(c,1)),d=Math.max(0,Math.min(d,1)),e=0.5>=d?d*(1+c):d+c-d*c,f=2*d-e;return pv.rgb(Math.round(255*a(b+120)),Math.round(255*a(b)),Math.round(255*a(b-120)),this.a)};
pv.Color.names={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",
darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",
ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",
lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",
moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",
seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",transparent:pv.Color.transparent=pv.rgb(0,0,0,0)};(function(){var a=pv.Color.names,b;for(b in a)a[b]=pv.color(a[b])})();
pv.colors=function(){var a=pv.Scale.ordinal();a.range.apply(a,arguments);return a};pv.Colors={};pv.Colors.category10=function(){var a=pv.colors("#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf");a.domain.apply(a,arguments);return a};
pv.Colors.category20=function(){var a=pv.colors("#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5");a.domain.apply(a,arguments);return a};
pv.Colors.category19=function(){var a=pv.colors("#9c9ede","#7375b5","#4a5584","#cedb9c","#b5cf6b","#8ca252","#637939","#e7cb94","#e7ba52","#bd9e39","#8c6d31","#e7969c","#d6616b","#ad494a","#843c39","#de9ed6","#ce6dbd","#a55194","#7b4173");a.domain.apply(a,arguments);return a};
(function(){function a(a){if(a in j)return j[a];var b=c(a);if(!b.length)return null;var f=Math.PI,g,h=b[0];if(0===h.indexOf("to ")){if(g=/^to\s+(?:((top|bottom)(?:\s+(left|right))?)|((left|right)(?:\\s+(top|bottom))?))$/.exec(h))g[1]?(f=g[2],g[3]&&(f+=" "+g[3])):(f=g[5],g[6]&&(f=g[6]+" "+f)),f=pv.radians(e[f]),b.shift()}else g=parseFloat(h),isNaN(g)||(f=g,/^.*?deg$/.test(h)&&(f=pv.radians(f)),b.shift());b=d(b);switch(b.length){case 0:return null;case 1:return new pv.FillStyle.Solid(b[0].color,1)}j[a]=
new pv.FillStyle.LinearGradient(f,b);return j[a]}function b(a){a=c(a);if(!a.length)return null;a=d(a);switch(a.length){case 0:return null;case 1:return new pv.FillStyle.Solid(a[0].color,1)}return new pv.FillStyle.RadialGradient(50,50,a)}function c(a){var b={},c=0,a=a.replace(/\b\w+?\(.*?\)/g,function(a){var d="__color"+c++;b[d]=a;return d}),d=a.split(/\s*,\s*/);if(!d.length)return null;c&&d.forEach(function(a,c){b.hasOwnProperty(a)&&(d[c]=b[a])});return d}function d(a){for(var b=[],c=Infinity,d=-Infinity,
e=[],f=0,g=a.length;f<g;){var h=a[f++];if(h=/^(.+?)\s*([+\-]?[e\.\d]+%)?$/i.exec(h)){var i={color:pv.color(h[1])},h=parseFloat(h[2]);isNaN(h)&&(b.length?f===g&&(h=Math.max(d,100)):h=0);b.push(i);if(isNaN(h))e.push(i);else{i.offset=h;if(i=e.length){for(var j=d,k=(h-j)/(i+1),l=0;l<i;l++)j+=k,e[l].offset=j;e.length=0}h>d?d=h:h<d&&(h=d);h<c&&(c=h)}}}if(2<=b.length&&(0>c||100<d)){var z=[],A=[];b.forEach(function(a){z.push(a.offset);A.push(a.color)});a=pv.scale.linear().domain(z).range(A);if(0>c){for(;b.length&&
0>=b[0].offset;)b.shift();b.unshift({offset:0,color:a(0)})}if(100<d){for(;b.length&&100<=b[b.length-1].offset;)b.pop();b.push({offset:100,color:a(100)})}}return b}pv.fillStyle=function(c){if(c.type)return c;if(c.rgb)return new pv.FillStyle.Solid(c.color,c.opacity);var d=/^\s*([a-z\-]+)\(\s*(.*?)\s*\)\s*$/.exec(c);if(d)switch(d[1]){case "linear-gradient":return a(d[2]);case "radial-gradient":return b(d[2])}return new pv.FillStyle.Solid(pv.color(c))};var e={top:0,"top right":45,right:90,"bottom right":135,
bottom:180,"bottom left":225,left:270,"top left":315},f=pv.FillStyle=function(a){this.type=a};f.prototype=new pv.Color("none",1);f.prototype.rgb=function(){return pv.color(this.color).alpha(this.opacity)};var g=pv.FillStyle.Solid=function(a,b){f.call(this,"solid");a.rgb?(this.color=a.color,this.opacity=a.opacity):(this.color=a,this.opacity=b)};g.prototype=pv.extend(pv.FillStyle);g.prototype.alpha=function(a){return new g(this.color,a)};g.prototype.brighter=function(a){return new g(this.rgb().brighter(a))};
g.prototype.darker=function(a){return new g(this.color.darker(a))};pv.FillStyle.transparent=new g(pv.Color.transparent);var h=0,i=pv.FillStyle.Gradient=function(a,b){f.call(this,a);this.id=++h;this.stops=b;b.length&&(this.color=b[0].color.color)};i.prototype=pv.extend(pv.FillStyle);i.prototype.rgb=function(){return this.stops.length?this.stops[0].color:void 0};i.prototype.alpha=function(a){return this._clone(this.stops.map(function(b){return{offset:b.offset,color:b.color.alpha(a)}}))};i.prototype.darker=
function(a){return this._clone(this.stops.map(function(b){return{offset:b.offset,color:b.color.darker(a)}}))};i.prototype.brighter=function(a){return this._clone(this.stops.map(function(b){return{offset:b.offset,color:b.color.brighter(a)}}))};var j={},k=pv.FillStyle.LinearGradient=function(a,b){i.call(this,"lineargradient",b);this.angle=a};k.prototype=pv.extend(i);k.prototype._clone=function(a){return new k(this.angle,a)};var l=pv.FillStyle.RadialGradient=function(a,b,c){i.call(this,"radialgradient",
c);this.cx=a;this.cy=b};l.prototype=pv.extend(i);l.prototype._clone=function(a){return new l(this.cx,this.cy,a)}})();pv.ramp=function(a,b){var c=pv.Scale.linear();c.range.apply(c,arguments);return c};
pv.Scene=pv.SvgScene={svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns",xlink:"http://www.w3.org/1999/xlink",xhtml:"http://www.w3.org/1999/xhtml",scale:1,events:"DOMMouseScroll mousewheel mousedown mouseup mouseover mouseout mousemove click dblclick".split(" "),implicit:{svg:{"shape-rendering":"auto","pointer-events":"painted",x:0,y:0,dy:0,"text-anchor":"start",transform:"translate(0,0)",fill:"none","fill-opacity":1,stroke:"none","stroke-opacity":1,"stroke-width":1.5,"stroke-linejoin":"miter"},
css:{font:"10px sans-serif"}}};pv.SvgScene.updateAll=function(a){if(a.length&&a[0].reverse&&"line"!=a.type&&"area"!=a.type){for(var b=pv.extend(a),c=0,d=a.length-1;0<=d;c++,d--)b[c]=a[d];a=b}this.removeSiblings(this[a.type](a))};pv.SvgScene.create=function(a){return document.createElementNS(this.svg,a)};
pv.SvgScene.expect=function(a,b,c,d,e,f){a?("defs"===a.tagName&&(a=a.nextSibling),"a"===a.tagName&&(a=a.firstChild),a.tagName!==b&&(b=this.create(b),a.parentNode.replaceChild(b,a),a=b)):a=this.create(b);e&&this.setAttributes(a,e);f&&this.setStyle(a,f);return a};pv.SvgScene.setAttributes=function(a,b){for(var c in b){var d=b[c];d==this.implicit.svg[c]&&(d=null);null==d?a.removeAttribute(c):a.setAttribute(c,d)}};
pv.SvgScene.setStyle=function(a,b){for(var c in b){var d=b[c];d==this.implicit.css[c]&&(d=null);null==d?"batik"===pv.renderer()?a.removeAttribute(c):"svgweb"!=pv.renderer()&&a.style.removeProperty(c):"batik"==pv.renderer()?a.style.setProperty(c,d):a.style[c]=d}};pv.SvgScene.append=function(a,b,c){a.$scene={scenes:b,index:c};a=this.title(a,b[c]);a.parentNode||b.$g.appendChild(a);return a.nextSibling};
pv.SvgScene.title=function(a,b){var c=a.parentNode;c&&"a"!=c.tagName&&(c=null);if(b.title){c||(c=this.create("a"),c.setAttributeNS(this.xlink,"xlink:href",""),a.parentNode&&a.parentNode.replaceChild(c,a),c.appendChild(a));c.setAttributeNS(this.xlink,"xlink:title",b.title);for(var d=null,e=a.firstChild;null!=e;e=e.nextSibling)if("title"==e.nodeName){d=e;break}d?d.removeChild(d.firstChild):(d=this.create("title"),a.appendChild(d));"svgweb"==pv.renderer()?d.appendChild(document.createTextNode(b.title,
!0)):d.appendChild(document.createTextNode(b.title));return c}c&&c.parentNode.replaceChild(a,c);return a};pv.SvgScene.dispatch=pv.listener(function(a){var b=a.target.$scene;if(b){var c=a.type;switch(c){case "DOMMouseScroll":c="mousewheel";a.wheel=-480*a.detail;break;case "mousewheel":a.wheel=(window.opera?12:1)*a.wheelDelta}pv.Mark.dispatch(c,b.scenes,b.index,a)&&a.preventDefault()}});
pv.SvgScene.removeSiblings=function(a){for(;a;){var b=a.nextSibling;"defs"!=a.nodeName&&a.parentNode.removeChild(a);a=b}};pv.SvgScene.undefined=function(){};pv.SvgScene.removeFillStyleDefinitions=function(a){a=a.$g.getElementsByTagName("defs");if(1===a.length)for(var a=a[0],b=a.firstChild;b;){var c=b.nextSibling;("linearGradient"==b.nodeName||"radialGradient"==b.nodeName)&&a.removeChild(b);b=c}};
(function(){var a=0;pv.SvgScene.addFillStyleDefinition=function(b,c){var d="lineargradient"===c.type;if(d||"radialgradient"===c.type){var e=b.$g,f=e.getElementsByTagName("defs"),f=f.length?f[0]:e.appendChild(this.create("defs")),g="__pv_gradient"+c.id,e="__pv_gradient"+c.id+"_inst_"+ ++a,f=f.appendChild(this.create(d?"linearGradient":"radialGradient"));f.setAttribute("id",e);f.setAttribute("class",g);if(d){var g=c.angle-Math.PI/2,d=Math.abs(g%(Math.PI/2))-Math.PI/4,h=Math.abs(Math.SQRT2/2*Math.cos(d)),
d=h*Math.cos(g),i=h*Math.sin(g),g=0.5-i,h=0.5+d,i=0.5+i;f.setAttribute("x1",0.5-d);f.setAttribute("y1",g);f.setAttribute("x2",h);f.setAttribute("y2",i)}d=c.stops;g=0;for(h=d.length;g<h;g++){var i=d[g],j=f.appendChild(this.create("stop")),k=i.color;j.setAttribute("offset",i.offset+"%");j.setAttribute("stop-color",k.color);j.setAttribute("stop-opacity",k.opacity+"")}c.color="url(#"+e+")"}}})();
pv.SvgScene.pathBasis=function(){function a(a,b,c,g,h){return{x:a[0]*b.left+a[1]*c.left+a[2]*g.left+a[3]*h.left,y:a[0]*b.top+a[1]*c.top+a[2]*g.top+a[3]*h.top}}var b=[[1/6,2/3,1/6,0],[0,2/3,1/3,0],[0,1/3,2/3,0],[0,1/6,2/3,1/6]],c=function(c,e,f,g){var h=a(b[1],c,e,f,g),i=a(b[2],c,e,f,g),c=a(b[3],c,e,f,g);return"C"+h.x+","+h.y+","+i.x+","+i.y+","+c.x+","+c.y};c.segment=function(c,e,f,g){var h=a(b[0],c,e,f,g),i=a(b[1],c,e,f,g),j=a(b[2],c,e,f,g),c=a(b[3],c,e,f,g);return"M"+h.x+","+h.y+"C"+i.x+","+i.y+
","+j.x+","+j.y+","+c.x+","+c.y};return c}();pv.SvgScene.curveBasis=function(a){if(2>=a.length)return"";var b,c=a[0],d=c,e=c,f=a[1];b=""+this.pathBasis(c,d,e,f);for(var g=2;g<a.length;g++)c=d,d=e,e=f,f=a[g],b+=this.pathBasis(c,d,e,f);b+=this.pathBasis(d,e,f,f);return b+=this.pathBasis(e,f,f,f)};
pv.SvgScene.curveBasisSegments=function(a){if(2>=a.length)return"";var b=[],c=a[0],d=c,e=c,f=a[1],g=this.pathBasis.segment(c,d,e,f),c=d,d=e,e=f,f=a[2];b.push(g+this.pathBasis(c,d,e,f));for(g=3;g<a.length;g++)c=d,d=e,e=f,f=a[g],b.push(this.pathBasis.segment(c,d,e,f));b.push(this.pathBasis.segment(d,e,f,f)+this.pathBasis(e,f,f,f));return b};
pv.SvgScene.curveHermite=function(a,b){if(1>b.length||a.length!=b.length&&a.length!=b.length+2)return"";var c=a.length!=b.length,d="",e=a[0],f=a[1],g=b[0],h=g,i=1;c&&(d+="Q"+(f.left-2*g.x/3)+","+(f.top-2*g.y/3)+","+f.left+","+f.top,e=a[1],i=2);if(1<b.length){h=b[1];f=a[i];i++;d+="C"+(e.left+g.x)+","+(e.top+g.y)+","+(f.left-h.x)+","+(f.top-h.y)+","+f.left+","+f.top;for(e=2;e<b.length;e++,i++)f=a[i],h=b[e],d+="S"+(f.left-h.x)+","+(f.top-h.y)+","+f.left+","+f.top}c&&(c=a[i],d+="Q"+(f.left+2*h.x/3)+","+
(f.top+2*h.y/3)+","+c.left+","+c.top);return d};
pv.SvgScene.curveHermiteSegments=function(a,b){if(1>b.length||a.length!=b.length&&a.length!=b.length+2)return[];var c=a.length!=b.length,d=[],e=a[0],f=e,g=b[0],h=g,i=1;c&&(f=a[1],d.push("M"+e.left+","+e.top+"Q"+(f.left-2*h.x/3)+","+(f.top-2*h.y/3)+","+f.left+","+f.top),i=2);for(var j=1;j<b.length;j++,i++)e=f,g=h,f=a[i],h=b[j],d.push("M"+e.left+","+e.top+"C"+(e.left+g.x)+","+(e.top+g.y)+","+(f.left-h.x)+","+(f.top-h.y)+","+f.left+","+f.top);c&&(c=a[i],d.push("M"+f.left+","+f.top+"Q"+(f.left+2*h.x/
3)+","+(f.top+2*h.y/3)+","+c.left+","+c.top));return d};pv.SvgScene.cardinalTangents=function(a,b){for(var c=[],d=(1-b)/2,e=a[0],f=a[1],g=a[2],h=3;h<a.length;h++)c.push({x:d*(g.left-e.left),y:d*(g.top-e.top)}),e=f,f=g,g=a[h];c.push({x:d*(g.left-e.left),y:d*(g.top-e.top)});return c};pv.SvgScene.curveCardinal=function(a,b){return 2>=a.length?"":this.curveHermite(a,this.cardinalTangents(a,b))};
pv.SvgScene.curveCardinalSegments=function(a,b){return 2>=a.length?"":this.curveHermiteSegments(a,this.cardinalTangents(a,b))};
pv.SvgScene.monotoneTangents=function(a){for(var b=[],c=[],d=[],e=[],f=0,f=0;f<a.length-1;f++)c[f]=(a[f+1].top-a[f].top)/(a[f+1].left-a[f].left);d[0]=c[0];e[0]=a[1].left-a[0].left;for(f=1;f<a.length-1;f++)d[f]=(c[f-1]+c[f])/2,e[f]=(a[f+1].left-a[f-1].left)/2;d[f]=c[f-1];e[f]=a[f].left-a[f-1].left;for(f=0;f<a.length-1;f++)0==c[f]&&(d[f]=0,d[f+1]=0);for(f=0;f<a.length-1;f++)if(!(1E-5>Math.abs(d[f])||1E-5>Math.abs(d[f+1]))){var g=d[f]/c[f],h=d[f+1]/c[f],i=g*g+h*h;9<i&&(i=3/Math.sqrt(i),d[f]=i*g*c[f],
d[f+1]=i*h*c[f])}for(f=0;f<a.length;f++)c=1+d[f]*d[f],b.push({x:e[f]/3/c,y:d[f]*e[f]/3/c});return b};pv.SvgScene.curveMonotone=function(a){return 2>=a.length?"":this.curveHermite(a,this.monotoneTangents(a))};pv.SvgScene.curveMonotoneSegments=function(a){return 2>=a.length?"":this.curveHermiteSegments(a,this.monotoneTangents(a))};
pv.SvgScene.area=function(a){function b(b,c){for(var d=[],f=[],g=c;b<=g;b++,c--){var h=a[b],i=a[c],h=h.left+","+h.top,i=i.left+i.width+","+(i.top+i.height);if(b<g){var j=a[b+1],k=a[c-1];switch(e.interpolate){case "step-before":h+="V"+j.top;i+="H"+(k.left+k.width);break;case "step-after":h+="H"+j.left,i+="V"+(k.top+k.height)}}d.push(h);f.push(i)}return d.concat(f).join("L")}function c(b,c){var d=[],f=[],g,h;for(g=c;b<=g;b++,c--)h=a[c],d.push(a[b]),f.push({left:h.left+h.width,top:h.top+h.height});"basis"==
e.interpolate?(g=pv.SvgScene.curveBasis(d),h=pv.SvgScene.curveBasis(f)):"cardinal"==e.interpolate?(g=pv.SvgScene.curveCardinal(d,e.tension),h=pv.SvgScene.curveCardinal(f,e.tension)):(g=pv.SvgScene.curveMonotone(d),h=pv.SvgScene.curveMonotone(f));return d[0].left+","+d[0].top+g+"L"+f[0].left+","+f[0].top+h}var d=a.$g.firstChild;this.removeFillStyleDefinitions(a);if(!a.length)return d;var e=a[0];if(e.segmented)return this.areaSegment(a);if(!e.visible)return d;var f=e.fillStyle,g=e.strokeStyle;if(!f.opacity&&
!g.opacity)return d;f.type&&"solid"!==f.type&&this.addFillStyleDefinition(a,f);g.type&&"solid"!=g.type&&this.addFillStyleDefinition(a,g);for(var h=[],i,j=0;j<a.length;j++)if(i=a[j],i.width||i.height){for(var k=j+1;k<a.length&&!(i=a[k],!i.width&&!i.height);k++);j&&"step-after"!=e.interpolate&&j--;k<a.length&&"step-before"!=e.interpolate&&k++;h.push((2<k-j&&("basis"==e.interpolate||"cardinal"==e.interpolate||"monotone"==e.interpolate)?c:b)(j,k-1));j=k-1}if(!h.length)return d;d=this.expect(d,"path",
a,0,{"shape-rendering":e.antialias?null:"crispEdges","pointer-events":e.events,cursor:e.cursor,d:"M"+h.join("ZM")+"Z",fill:f.color,"fill-opacity":f.opacity||null,stroke:g.color,"stroke-opacity":g.opacity||null,"stroke-width":g.opacity?e.lineWidth/this.scale:null});e.svg&&this.setAttributes(d,e.svg);e.css&&this.setStyle(d,e.css);return this.append(d,a,0)};
pv.SvgScene.areaSegment=function(a){var b=a.$g.firstChild,c=a[0],d,e;if("basis"==c.interpolate||"cardinal"==c.interpolate||"monotone"==c.interpolate){d=[];e=[];for(var f=0,g=a.length;f<g;f++){var h=a[g-f-1];d.push(a[f]);e.push({left:h.left+h.width,top:h.top+h.height})}"basis"==c.interpolate?(d=this.curveBasisSegments(d),e=this.curveBasisSegments(e)):"cardinal"==c.interpolate?(d=this.curveCardinalSegments(d,c.tension),e=this.curveCardinalSegments(e,c.tension)):(d=this.curveMonotoneSegments(d),e=this.curveMonotoneSegments(e))}f=
0;for(g=a.length-1;f<g;f++){var c=a[f],i=a[f+1];if(c.visible&&i.visible){var j=c.fillStyle,k=c.strokeStyle;if(j.opacity||k.opacity){if(d)h=d[f],i="L"+e[g-f-1].substr(1),h=h+i+"Z";else{var l=c,h=i;switch(c.interpolate){case "step-before":l=i;break;case "step-after":h=c}h="M"+c.left+","+l.top+"L"+i.left+","+h.top+"L"+(i.left+i.width)+","+(h.top+h.height)+"L"+(c.left+c.width)+","+(l.top+l.height)+"Z"}b=this.expect(b,"path",a,f,{"shape-rendering":c.antialias?null:"crispEdges","pointer-events":c.events,
cursor:c.cursor,d:h,fill:j.color,"fill-opacity":j.opacity||null,stroke:k.color,"stroke-opacity":k.opacity||null,"stroke-width":k.opacity?c.lineWidth/this.scale:null});c.svg&&this.setAttributes(b,c.svg);c.css&&this.setStyle(b,c.css);b=this.append(b,a,f)}}}return b};
pv.SvgScene.bar=function(a){var b=a.$g.firstChild;this.removeFillStyleDefinitions(a);for(var c=0;c<a.length;c++){var d=a[c];if(d.visible&&!(1E-10>=Math.abs(d.width)||1E-10>=Math.abs(d.height))){var e=d.fillStyle,f=d.strokeStyle;if(e.opacity||f.opacity)e.type&&"solid"!==e.type&&this.addFillStyleDefinition(a,e),f.type&&"solid"!=f.type&&this.addFillStyleDefinition(a,f),b=this.expect(b,"rect",a,c,{"shape-rendering":d.antialias?null:"crispEdges","pointer-events":d.events,cursor:d.cursor,x:d.left,y:d.top,
width:Math.max(1E-10,d.width),height:Math.max(1E-10,d.height),fill:e.color,"fill-opacity":e.opacity||null,stroke:f.color,"stroke-opacity":f.opacity||null,"stroke-width":f.opacity?d.lineWidth/this.scale:null}),d.svg&&this.setAttributes(b,d.svg),d.css&&this.setStyle(b,d.css),b=this.append(b,a,c)}}return b};
pv.SvgScene.dot=function(a){var b=a.$g.firstChild;this.removeFillStyleDefinitions(a);for(var c=0;c<a.length;c++){var d=a[c];if(d.visible){var e=d.fillStyle,f=d.strokeStyle;if(e.opacity||f.opacity){e.type&&"solid"!==e.type&&this.addFillStyleDefinition(a,e);f.type&&"solid"!=f.type&&this.addFillStyleDefinition(a,f);var g=d.shapeRadius,h=null;switch(d.shape){case "cross":h="M"+-g+","+-g+"L"+g+","+g+"M"+g+","+-g+"L"+-g+","+g;break;case "triangle":var h=g,i=1.1547*g,h="M0,"+h+"L"+i+","+-h+" "+-i+","+-h+
"Z";break;case "diamond":g*=Math.SQRT2;h="M0,"+-g+"L"+g+",0 0,"+g+" "+-g+",0Z";break;case "square":h="M"+-g+","+-g+"L"+g+","+-g+" "+g+","+g+" "+-g+","+g+"Z";break;case "tick":h="M0,0L0,"+-d.shapeSize;break;case "bar":h="M0,"+d.shapeSize/2+"L0,"+-(d.shapeSize/2)}e={"shape-rendering":d.antialias?null:"crispEdges","pointer-events":d.events,cursor:d.cursor,fill:e.color,"fill-opacity":e.opacity||null,stroke:f.color,"stroke-opacity":f.opacity||null,"stroke-width":f.opacity?d.lineWidth/this.scale:null,"stroke-dasharray":d.strokeDasharray||
"none"};h?(e.transform="translate("+d.left+","+d.top+")",d.shapeAngle&&(e.transform+=" rotate("+180*d.shapeAngle/Math.PI+")"),e.d=h,b=this.expect(b,"path",a,c,e)):(e.cx=d.left,e.cy=d.top,e.r=g,b=this.expect(b,"circle",a,c,e));d.svg&&this.setAttributes(b,d.svg);d.css&&this.setStyle(b,d.css);b=this.append(b,a,c)}}}return b};
pv.SvgScene.image=function(a){for(var b=a.$g.firstChild,c=0;c<a.length;c++){var d=a[c];if(d.visible){b=this.fill(b,a,c);if(d.image){b=this.expect(b,"foreignObject",a,c,{cursor:d.cursor,x:d.left,y:d.top,width:d.width,height:d.height});d.svg&&this.setAttributes(b,d.svg);d.css&&this.setStyle(b,d.css);var e=b.firstChild||b.appendChild(document.createElementNS(this.xhtml,"canvas"));e.$scene={scenes:a,index:c};e.style.width=d.width;e.style.height=d.height;e.width=d.imageWidth;e.height=d.imageHeight;e.getContext("2d").putImageData(d.image,
0,0)}else b=this.expect(b,"image",a,c,{preserveAspectRatio:"none",cursor:d.cursor,x:d.left,y:d.top,width:d.width,height:d.height}),d.svg&&this.setAttributes(b,d.svg),d.css&&this.setStyle(b,d.css),b.setAttributeNS(this.xlink,"xlink:href",d.url);b=this.append(b,a,c);b=this.stroke(b,a,c)}}return b};
pv.SvgScene.label=function(a){for(var b=a.$g.firstChild,c=0;c<a.length;c++){var d=a[c];if(d.visible){var e=d.textStyle;if(e.opacity&&d.text){var f=0,g=0,h=0,i="start";switch(d.textBaseline){case "middle":"svgweb"==pv.renderer()?g=3:h=".35em";break;case "top":"svgweb"==pv.renderer()?g=9+d.textMargin:(h=".71em",g=d.textMargin);break;case "bottom":g="-"+d.textMargin}switch(d.textAlign){case "right":i="end";f="-"+d.textMargin;break;case "center":i="middle";break;case "left":f=d.textMargin}b=this.expect(b,
"text",a,c,{"pointer-events":d.events,cursor:d.cursor,x:f,y:g,dy:h,transform:"translate("+d.left+","+d.top+")"+(d.textAngle?" rotate("+180*d.textAngle/Math.PI+")":"")+(1!=this.scale?" scale("+1/this.scale+")":""),fill:e.color,"fill-opacity":e.opacity||null,"text-anchor":i},{font:d.font,"text-shadow":d.textShadow,"text-decoration":d.textDecoration});d.svg&&this.setAttributes(b,d.svg);d.css&&this.setStyle(b,d.css);b.firstChild?b.firstChild.nodeValue=d.text:"svgweb"==pv.renderer()?b.appendChild(document.createTextNode(d.text,
!0)):b.appendChild(document.createTextNode(d.text));b=this.append(b,a,c)}}}return b};
pv.SvgScene.line=function(a){var b=a.$g.firstChild;this.removeFillStyleDefinitions(a);if(2>a.length)return b;var c=a[0];if(c.segmented)return this.lineSegment(a);if(!c.visible)return b;var d=c.fillStyle,e=c.strokeStyle;if(!d.opacity&&!e.opacity)return b;e.type&&"solid"!=e.type&&this.addFillStyleDefinition(a,e);var f="M"+c.left+","+c.top;if(2<a.length&&("basis"==c.interpolate||"cardinal"==c.interpolate||"monotone"==c.interpolate))switch(c.interpolate){case "basis":f+=this.curveBasis(a);break;case "cardinal":f+=
this.curveCardinal(a,c.tension);break;case "monotone":f+=this.curveMonotone(a)}else for(var g=1;g<a.length;g++)f+=this.pathSegment(a[g-1],a[g]);b=this.expect(b,"path",a,0,{"shape-rendering":c.antialias?null:"crispEdges","pointer-events":c.events,cursor:c.cursor,d:f,fill:d.color,"fill-opacity":d.opacity||null,stroke:e.color,"stroke-opacity":e.opacity||null,"stroke-width":e.opacity?c.lineWidth/this.scale:null,"stroke-linejoin":c.lineJoin,"stroke-dasharray":c.strokeDasharray||"none"});c.svg&&this.setAttributes(b,
c.svg);c.css&&this.setStyle(b,c.css);return this.append(b,a,0)};
pv.SvgScene.lineSegment=function(a){var b=a.$g.firstChild,c=a[0],d;switch(c.interpolate){case "basis":d=this.curveBasisSegments(a);break;case "cardinal":d=this.curveCardinalSegments(a,c.tension);break;case "monotone":d=this.curveMonotoneSegments(a)}for(var c=0,e=a.length-1;c<e;c++){var f=a[c],g=a[c+1];if(f.visible&&g.visible){var h=f.strokeStyle,i=pv.FillStyle.transparent;h.opacity&&("linear"==f.interpolate&&"miter"==f.lineJoin?(i=h,h=pv.FillStyle.transparent,g=this.pathJoin(a[c-1],f,g,a[c+2])):g=
d?d[c]:"M"+f.left+","+f.top+this.pathSegment(f,g),b=this.expect(b,"path",a,c,{"shape-rendering":f.antialias?null:"crispEdges","pointer-events":f.events,cursor:f.cursor,d:g,fill:i.color,"fill-opacity":i.opacity||null,stroke:h.color,"stroke-opacity":h.opacity||null,"stroke-width":h.opacity?f.lineWidth/this.scale:null,"stroke-linejoin":f.lineJoin}),f.svg&&this.setAttributes(b,f.svg),f.css&&this.setStyle(b,f.css),b=this.append(b,a,c))}}return b};
pv.SvgScene.pathSegment=function(a,b){var c=1;switch(a.interpolate){case "polar-reverse":c=0;case "polar":var d=b.left-a.left,e=b.top-a.top,f=1-a.eccentricity,d=Math.sqrt(d*d+e*e)/(2*f);if(0>=f||1<f)break;return"A"+d+","+d+" 0 0,"+c+" "+b.left+","+b.top;case "step-before":return"V"+b.top+"H"+b.left;case "step-after":return"H"+b.left+"V"+b.top}return"L"+b.left+","+b.top};pv.SvgScene.lineIntersect=function(a,b,c,d){return a.plus(b.times(c.minus(a).dot(d.perp())/b.dot(d.perp())))};
pv.strokeMiterLimit=4;
pv.SvgScene.pathJoin=function(a,b,c,d){var e=[],f,g=b.lineWidth/this.scale,h=pv.vector(b.left,b.top),i=pv.vector(c.left,c.top),j=i.minus(h),k=j.perp().norm(),l=k.times(g/2),m=h.plus(l),s=h.minus(l),x=i.plus(l),l=i.minus(l);if(!a||!a.visible)e.push(s,m);else{f=pv.vector(a.left,a.top);var v=h.minus(f);f=v.perp().norm().plus(k).norm();var u=this.lineIntersect(h,f,m,j),q=this.lineIntersect(h,f,s,j);f=u.minus(q).length();a=(g+a.lineWidth/this.scale)/2;b=b.strokeMiterLimit||pv.strokeMiterLimit;f/a<=b?e.push(q,
u):(f=j.times(-1),f=v.norm().plus(f.norm()).norm(),h=h.plus(f.times(a/2)),0<=f.dot(k)?e.push(q,h,m):e.push(s,h,u))}!d||!d.visible?e.push(x,l):(h=pv.vector(d.left,d.top).minus(i),s=h.perp().norm().plus(k).norm(),m=this.lineIntersect(i,s,x,j),s=this.lineIntersect(i,s,l,j),f=m.minus(s).length(),d=(d.lineWidth/this.scale+g)/2,b=c.strokeMiterLimit||pv.strokeMiterLimit,f/d<=b?e.push(m,s):(c=h.times(-1),j=j.norm().plus(c.norm()).norm(),i=i.plus(j.times(d/2)),0<=j.dot(k)?e.push(x,i,s):e.push(m,i,l)));k=e.shift();
return"M"+k.x+","+k.y+"L"+e.map(function(a){return a.x+","+a.y}).join(" ")};
pv.SvgScene.panel=function(a){for(var b=a.$g,c=b&&b.firstChild,d=!1,e=0;e<a.length;e++){var f=a[e];if(f.visible){if(!a.parent){"batik"!==pv.renderer()&&(f.canvas.style.display="inline-block");b&&b.parentNode!=f.canvas&&(c=(b=f.canvas.firstChild)&&b.firstChild);if(!b){b=this.create("batik"!==pv.renderer()?"svg":"g");b.setAttribute("font-size","10px");b.setAttribute("font-family","sans-serif");b.setAttribute("fill","none");b.setAttribute("stroke","none");b.setAttribute("stroke-width",1.5);if("svgweb"==
pv.renderer()){b.setAttribute("width",f.width+f.left+f.right);b.setAttribute("height",f.height+f.top+f.bottom);var g=document.createDocumentFragment(!0);b.addEventListener("SVGLoad",function(){var b=this;(function(){if(d){d=!1;b.appendChild(g);for(var c=0;c<pv.Scene.events.length;c++)b.addEventListener(pv.Scene.events[c],pv.SvgScene.dispatch,!1);a.$g=b;a.$g.__ready=!0}else setTimeout(arguments.callee,10)})()},!1);svgweb.appendChild(b,f.canvas);b=g}else{for(var h=0;h<this.events.length;h++)b.addEventListener(this.events[h],
this.dispatch,!1);b=f.canvas.appendChild(b);b.__ready=!0}c=b.firstChild}a.$g=b;b.__ready&&(b.setAttribute("width",f.width+f.left+f.right),b.setAttribute("height",f.height+f.top+f.bottom))}if("hidden"==f.overflow){var h=pv.id().toString(36),i=this.expect(c,"g",a,e,{"clip-path":"url(#"+h+")"});i.parentNode||b.appendChild(i);a.$g=b=i;c=i.firstChild;c=this.expect(c,"clipPath",a,e,{id:h});h=c.firstChild||c.appendChild(this.create("rect"));h.setAttribute("x",f.left);h.setAttribute("y",f.top);h.setAttribute("width",
f.width);h.setAttribute("height",f.height);c.parentNode||b.appendChild(c);c=c.nextSibling}var c=this.fill(c,a,e),j=this.scale,k=f.transform,l=f.left+k.x,m=f.top+k.y;this.scale*=k.k;for(h=0;h<f.children.length;h++)f.children[h].$g=c=this.expect(c,"g",a,e,{transform:"translate("+l+","+m+")"+(1!=k.k?" scale("+k.k+")":"")}),this.updateAll(f.children[h]),c.parentNode||b.appendChild(c),c=c.nextSibling;this.scale=j;c=this.stroke(c,a,e);"hidden"==f.overflow&&(a.$g=b=i.parentNode,c=i.nextSibling)}}d=!0;return c};
pv.SvgScene.fill=function(a,b,c){this.removeFillStyleDefinitions(b);var d=b[c],e=d.fillStyle;if(e.opacity||"all"==d.events)e.type&&"solid"!==e.type&&this.addFillStyleDefinition(b,e),a=this.expect(a,"rect",b,c,{"shape-rendering":d.antialias?null:"crispEdges","pointer-events":d.events,cursor:d.cursor,x:d.left,y:d.top,width:d.width,height:d.height,fill:e.color,"fill-opacity":e.opacity,stroke:null}),a=this.append(a,b,c);return a};
pv.SvgScene.stroke=function(a,b,c){var d=b[c],e=d.strokeStyle;if(e.opacity||"all"==d.events)a=this.expect(a,"rect",b,c,{"shape-rendering":d.antialias?null:"crispEdges","pointer-events":"all"==d.events?"stroke":d.events,cursor:d.cursor,x:d.left,y:d.top,width:Math.max(1E-10,d.width),height:Math.max(1E-10,d.height),fill:null,stroke:e.color,"stroke-opacity":e.opacity,"stroke-width":d.lineWidth/this.scale}),a=this.append(a,b,c);return a};
pv.SvgScene.rule=function(a){for(var b=a.$g.firstChild,c=0;c<a.length;c++){var d=a[c];if(d.visible){var e=d.strokeStyle;e.opacity&&(b=this.expect(b,"line",a,c,{"shape-rendering":d.antialias?null:"crispEdges","pointer-events":d.events,cursor:d.cursor,x1:d.left,y1:d.top,x2:d.left+d.width,y2:d.top+d.height,stroke:e.color,"stroke-opacity":e.opacity,"stroke-width":d.lineWidth/this.scale,"stroke-dasharray":d.strokeDasharray||"none"}),d.svg&&this.setAttributes(b,d.svg),d.css&&this.setStyle(b,d.css),b=this.append(b,
a,c))}}return b};
pv.SvgScene.wedge=function(a){var b=a.$g.firstChild;this.removeFillStyleDefinitions(a);for(var c=0;c<a.length;c++){var d=a[c];if(d.visible){var e=d.fillStyle,f=d.strokeStyle;if(e.opacity||f.opacity){var g=d.innerRadius,h=d.outerRadius,i=Math.abs(d.angle);if(i>=2*Math.PI)g=g?"M0,"+h+"A"+h+","+h+" 0 1,1 0,"+-h+"A"+h+","+h+" 0 1,1 0,"+h+"M0,"+g+"A"+g+","+g+" 0 1,1 0,"+-g+"A"+g+","+g+" 0 1,1 0,"+g+"Z":"M0,"+h+"A"+h+","+h+" 0 1,1 0,"+-h+"A"+h+","+h+" 0 1,1 0,"+h+"Z";else var j=Math.min(d.startAngle,d.endAngle),
k=Math.max(d.startAngle,d.endAngle),l=Math.cos(j),m=Math.cos(k),j=Math.sin(j),k=Math.sin(k),g=g?"M"+h*l+","+h*j+"A"+h+","+h+" 0 "+(i<Math.PI?"0":"1")+",1 "+h*m+","+h*k+"L"+g*m+","+g*k+"A"+g+","+g+" 0 "+(i<Math.PI?"0":"1")+",0 "+g*l+","+g*j+"Z":"M"+h*l+","+h*j+"A"+h+","+h+" 0 "+(i<Math.PI?"0":"1")+",1 "+h*m+","+h*k+"L0,0Z";e.type&&"solid"!==e.type&&this.addFillStyleDefinition(a,e);f.type&&"solid"!=f.type&&this.addFillStyleDefinition(a,f);b=this.expect(b,"path",a,c,{"shape-rendering":d.antialias?null:
"crispEdges","pointer-events":d.events,cursor:d.cursor,transform:"translate("+d.left+","+d.top+")",d:g,fill:e.color,"fill-rule":"evenodd","fill-opacity":e.opacity||null,stroke:f.color,"stroke-opacity":f.opacity||null,"stroke-width":f.opacity?d.lineWidth/this.scale:null});d.svg&&this.setAttributes(b,d.svg);d.css&&this.setStyle(b,d.css);b=this.append(b,a,c)}}}return b};pv.Mark=function(){this.$properties=[];this.$handlers={}};pv.Mark.prototype.properties={};pv.Mark.cast={};
pv.Mark.prototype.property=function(a,b){this.hasOwnProperty("properties")||(this.properties=pv.extend(this.properties));this.properties[a]=!0;pv.Mark.prototype.propertyMethod(a,!1,pv.Mark.cast[a]=b);return this};
pv.Mark.prototype.propertyMethod=function(a,b,c){c||(c=pv.Mark.cast[a]);this[a]=function(d){if(b&&this.scene){var e=this.scene.defs;return arguments.length?(e[a]={id:null==d?0:pv.id(),value:null!=d&&c?c(d):d},this):e[a]?e[a].value:null}if(arguments.length){var e=!b<<1|"function"===typeof d,f;f=e&1&&c?function(){var a=d.apply(this,arguments);return null!=a?c(a):null}:null!=d&&c?c(d):d;this.propertyValue(a,f,e);return this}return this.instance()[a]}};
pv.Mark.prototype.propertyValue=function(a,b,c){for(var d=this.$properties,b={name:a,id:pv.id(),value:b,type:c},c=0;c<d.length;c++)if(d[c].name===a){d.splice(c,1);break}d.push(b);return b};
pv.Mark.prototype.property("data").property("visible",Boolean).property("datum",Object).property("css",Object).property("svg",Object).property("left",Number).property("right",Number).property("top",Number).property("bottom",Number).property("cursor",String).property("title",String).property("reverse",Boolean).property("antialias",Boolean).property("events",String).property("id",String);pv.Mark.prototype.childIndex=-1;pv.Mark.prototype.index=-1;pv.Mark.prototype.scale=1;
pv.Mark.prototype.defaults=(new pv.Mark).data(function(a){return[a]}).datum(function(){return this.parent?this.parent.scene[this.parent.index].datum:null}).visible(!0).antialias(!0).events("painted");pv.Mark.prototype.extend=function(a){this.proto=a;this.target=a.target;return this};pv.Mark.prototype.add=function(a){return this.parent.add(a).extend(this)};pv.Mark.prototype.def=function(a,b){this.propertyMethod(a,!0);return this[a](1<arguments.length?b:null)};
pv.Mark.prototype.anchor=function(a){a||(a="center");return(new pv.Anchor(this)).name(a).data(function(){return this.scene.target.map(function(a){return a.data})}).datum(function(){return this.scene.target[this.index].datum}).visible(function(){return this.scene.target[this.index].visible}).id(function(){return this.scene.target[this.index].id}).left(function(){var a=this.scene.target[this.index],c=a.width||0;switch(this.name()){case "bottom":case "top":case "center":return a.left+c/2;case "left":return null}return a.left+
c}).top(function(){var a=this.scene.target[this.index],c=a.height||0;switch(this.name()){case "left":case "right":case "center":return a.top+c/2;case "top":return null}return a.top+c}).right(function(){var a=this.scene.target[this.index];return"left"==this.name()?a.right+(a.width||0):null}).bottom(function(){var a=this.scene.target[this.index];return"top"==this.name()?a.bottom+(a.height||0):null}).textAlign(function(){switch(this.name()){case "bottom":case "top":case "center":return"center";case "right":return"right"}return"left"}).textBaseline(function(){switch(this.name()){case "right":case "left":case "center":return"middle";
case "top":return"top"}return"bottom"})};pv.Mark.prototype.anchorTarget=function(){return this.target};pv.Mark.prototype.margin=function(a){return this.left(a).right(a).top(a).bottom(a)};pv.Mark.prototype.instance=function(a){var b=this.scene||this.parent.instance(-1).children[this.childIndex],c=!arguments.length||this.hasOwnProperty("index")?this.index:a;return b[0>c?b.length-1:c]};
pv.Mark.prototype.instances=function(a){for(var b=this,c=[],d;!(d=b.scene);)a=a.parent,c.push({index:a.index,childIndex:b.childIndex}),b=b.parent;for(;c.length;)a=c.pop(),d=d[a.index].children[a.childIndex];return this.hasOwnProperty("index")?(c=pv.extend(d[this.index]),c.right=c.top=c.left=c.bottom=0,[c]):d};pv.Mark.prototype.first=function(){return this.scene[0]};pv.Mark.prototype.last=function(){return this.scene[this.scene.length-1]};
pv.Mark.prototype.sibling=function(){return 0==this.index?null:this.scene[this.index-1]};pv.Mark.prototype.cousin=function(){var a=this.parent;return(a=a&&a.sibling())&&a.children?a.children[this.childIndex][this.index]:null};
pv.Mark.prototype.render=function(){function a(a,c,f){a.scale=f;if(c<e.length){d.unshift(null);if(a.hasOwnProperty("index"))b(a,c,f);else{for(var j=0,k=a.scene.length;j<k;j++)a.index=j,b(a,c,f);delete a.index}d.shift()}else a.build(),pv.Scene.scale=f,c=null,a.scene&&(a.scene.$g&&a.scene.$g.suspendRedraw)&&(c=a.scene.$g.suspendRedraw(1E3)),pv.Scene.updateAll(a.scene),c&&a.scene.$g.unsuspendRedraw(c);delete a.scale}function b(b,c,f){var j=b.scene[b.index],k;if(j.visible){var l=e[c],m=b.children[l];
for(k=0;k<l;k++)b.children[k].scene=j.children[k];d[0]=j.data;m.scene?a(m,c+1,f*j.transform.k):(m.scene=j.children[l],a(m,c+1,f*j.transform.k),delete m.scene);for(k=0;k<l;k++)delete b.children[k].scene}}var c=this.parent,d=pv.Mark.stack;if(c&&!this.root.scene)this.root.render();else{for(var e=[],f=this;f.parent;f=f.parent)e.unshift(f.childIndex);for(this.bind();c&&!c.hasOwnProperty("index");)c=c.parent;this.context(c?c.scene:void 0,c?c.index:-1,function(){a(this.root,0,1)})}};pv.Mark.stack=[];
pv.Mark.prototype.bind=function(){function a(a){do for(var f=a.$properties,g=f.length-1;0<=g;g--){var h=f[g];if(!(h.name in b))switch(b[h.name]=h,h.name){case "data":c=h;break;case "datum":case "visible":case "id":d.push(h);break;default:e[h.type].push(h)}}while(a=a.proto)}var b={},c,d=[],e=[[],[],[],[]],f={id:0,datum:1,visible:3};a(this);a(this.defaults);d.sort(function(a,b){return f[a.name]-f[b.name]});e[1].reverse();e[3].reverse();var g=this;do for(var h in g.properties)h in b||e[2].push(b[h]=
{name:h,type:2,value:null});while(g=g.proto);g=e[0].concat(e[1]);for(h=0;h<g.length;h++)this.propertyMethod(g[h].name,!0);this.binds={properties:b,data:c,defs:g,required:d,optional:pv.blend(e)}};
pv.Mark.prototype.build=function(){var a=this.scene,b=pv.Mark.stack;a||(a=this.scene=[],a.mark=this,a.type=this.type,a.childIndex=this.childIndex,this.parent&&(a.parent=this.parent.scene,a.parentIndex=this.parent.index));this.target&&(a.target=this.target.instances(a));if(this.binds.defs.length){var c=a.defs;c||(a.defs=c={});for(var d=0;d<this.binds.defs.length;d++){var e=this.binds.defs[d],f=c[e.name];if(!f||e.id>f.id)c[e.name]={id:0,value:e.type&1?e.value.apply(this,b):e.value}}}c=this.binds.data;
c=c.type&1?c.value.apply(this,b):c.value;b.unshift(null);a.length=c.length;for(d=0;d<c.length;d++)pv.Mark.prototype.index=this.index=d,(e=a[d])||(a[d]=e={}),e.data=b[0]=c[d],this.buildInstance(e);pv.Mark.prototype.index=-1;delete this.index;b.shift();return this};pv.Mark.prototype.buildProperties=function(a,b){for(var c=0,d=b.length;c<d;c++){var e=b[c],f=e.value;switch(e.type){case 0:case 1:f=this.scene.defs[e.name].value;break;case 3:f=f.apply(this,pv.Mark.stack)}a[e.name]=f}};
pv.Mark.prototype.buildInstance=function(a){this.buildProperties(a,this.binds.required);a.visible&&(this.buildProperties(a,this.binds.optional),this.buildImplied(a))};
pv.Mark.prototype.buildImplied=function(a){var b=a.left,c=a.right,d=a.top,e=a.bottom,f=this.properties,g=f.width?a.width:0,h=f.height?a.height:0,i=this.parent?this.parent.width():g+b+c;null==g?g=i-(c=c||0)-(b=b||0):null==c?null==b?b=c=(i-g)/2:c=i-g-b:null==b&&(b=i-g-c);i=this.parent?this.parent.height():h+d+e;null==h?h=i-(d=d||0)-(e=e||0):null==e?e=null==d?d=(i-h)/2:i-h-d:null==d&&(d=i-h-e);a.left=b;a.right=c;a.top=d;a.bottom=e;f.width&&(a.width=g);f.height&&(a.height=h);f.textStyle&&!a.textStyle&&
(a.textStyle=pv.FillStyle.transparent);f.fillStyle&&!a.fillStyle&&(a.fillStyle=pv.FillStyle.transparent);f.strokeStyle&&!a.strokeStyle&&(a.strokeStyle=pv.FillStyle.transparent)};
pv.Mark.prototype.mouse=function(){var a=this.root.canvas(),b=pv.scrollOffset(a),c=b[0]+1*pv.event.clientX,b=b[1]+1*pv.event.clientY;if("svgweb"!=pv.renderer()){do c-=a.offsetLeft,b-=a.offsetTop;while(a=a.offsetParent)}var a=pv.Transform.identity,d=this.properties.transform?this:this.parent,e=[];do e.push(d);while(d=d.parent);for(;d=e.pop();)a=a.translate(d.left(),d.top()).times(d.transform());a=a.invert();return pv.vector(c*a.k+a.x,b*a.k+a.y)};
pv.Mark.prototype.event=function(a,b){var b=pv.functor(b),c=this.$handlers[a];c?c instanceof Array?c.push(b):c=[c,b]:c=b;this.$handlers[a]=c;return this};
pv.Mark.prototype.context=function(a,b,c){function d(a,b){pv.Mark.scene=a;f.index=b;if(a){var c=a.mark,d=c,e=[];do e.push(d),g.push(a[b].data),d.index=b,d.scene=a,b=a.parentIndex,a=a.parent;while(d=d.parent);for(var h=e.length-1,i=1;0<h;h--)d=e[h],d.scale=i,i*=d.scene[d.index].transform.k;if(c.children){h=0;for(e=c.children.length;h<e;h++)d=c.children[h],d.scene=c.scene[c.index].children[h],d.scale=i}}}function e(a){if(a){var a=a.mark,b;if(a.children)for(var c=0,d=a.children.length;c<d;c++)b=a.children[c],
delete b.scene,delete b.scale;b=a;do g.pop(),b.parent&&(delete b.scene,delete b.scale),delete b.index;while(b=b.parent)}}var f=pv.Mark.prototype,g=pv.Mark.stack,h=pv.Mark.scene,i=f.index;e(h,i);d(a,b);try{c.apply(this,g)}catch(j){pv.error(j)}finally{e(a,b),d(h,i)}};
pv.Mark.dispatch=function(a,b,c,d){var e=b.mark,f=b.parent,g=e.$handlers[a];if(!g)return f&&pv.Mark.dispatch(a,f,b.parentIndex,d);e.context(b,c,function(){var a=pv.Mark.stack.concat(d);if(g instanceof Array){var b;g.forEach(function(c){(c=c.apply(e,a))&&c.render&&(b||(b=[])).push(c)});b&&b.forEach(function(a){a.render()})}else(e=g.apply(e,a))&&e.render&&e.render()});return!0};pv.Mark.prototype.transition=function(){return new pv.Transition(this)};
pv.Mark.prototype.on=function(a){return this["$"+a]=new pv.Transient(this)};pv.Anchor=function(a){pv.Mark.call(this);this.target=a;this.parent=a.parent};pv.Anchor.prototype=pv.extend(pv.Mark).property("name",String);pv.Anchor.prototype.extend=function(a){this.proto=a;return this};pv.Area=function(){pv.Mark.call(this)};
pv.Area.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.fillStyle).property("fillStyle",pv.fillStyle).property("segmented",Boolean).property("interpolate",String).property("tension",Number);pv.Area.prototype.type="area";pv.Area.prototype.defaults=(new pv.Area).extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(pv.Colors.category20().by(pv.parent)).interpolate("linear").tension(0.7);
pv.Area.prototype.buildImplied=function(a){null==a.height&&(a.height=0);null==a.width&&(a.width=0);pv.Mark.prototype.buildImplied.call(this,a)};pv.Area.fixed={lineWidth:1,lineJoin:1,strokeStyle:1,fillStyle:1,segmented:1,interpolate:1,tension:1};
pv.Area.prototype.bind=function(){pv.Mark.prototype.bind.call(this);for(var a=this.binds,b=a.required,a=a.optional,c=0,d=a.length;c<d;c++){var e=a[c];e.fixed=e.name in pv.Area.fixed;"segmented"==e.name&&(b.push(e),a.splice(c,1),c--,d--)}this.binds.$required=b;this.binds.$optional=a};
pv.Area.prototype.buildInstance=function(a){var b=this.binds;if(this.index){var c=b.fixed;if(!c){var c=b.fixed=[],d=function(a){return!a.fixed||(c.push(a),!1)};b.required=b.required.filter(d);this.scene[0].segmented||(b.optional=b.optional.filter(d))}b=0;for(d=c.length;b<d;b++){var e=c[b].name;a[e]=this.scene[0][e]}}else b.required=b.$required,b.optional=b.$optional,b.fixed=null;pv.Mark.prototype.buildInstance.call(this,a)};
pv.Area.prototype.anchor=function(a){return pv.Mark.prototype.anchor.call(this,a).interpolate(function(){return this.scene.target[this.index].interpolate}).eccentricity(function(){return this.scene.target[this.index].eccentricity}).tension(function(){return this.scene.target[this.index].tension})};pv.Bar=function(){pv.Mark.call(this)};
pv.Bar.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.fillStyle).property("fillStyle",pv.fillStyle);pv.Bar.prototype.type="bar";pv.Bar.prototype.defaults=(new pv.Bar).extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(pv.Colors.category20().by(pv.parent));pv.Dot=function(){pv.Mark.call(this)};
pv.Dot.prototype=pv.extend(pv.Mark).property("shape",String).property("shapeAngle",Number).property("shapeRadius",Number).property("shapeSize",Number).property("lineWidth",Number).property("strokeStyle",pv.fillStyle).property("strokeDasharray",String).property("fillStyle",pv.fillStyle);pv.Dot.prototype.type="dot";pv.Dot.prototype.defaults=(new pv.Dot).extend(pv.Mark.prototype.defaults).shape("circle").lineWidth(1.5).strokeStyle(pv.Colors.category10().by(pv.parent)).strokeDasharray("");
pv.Dot.prototype.anchor=function(a){return pv.Mark.prototype.anchor.call(this,a).left(function(){var a=this.scene.target[this.index];switch(this.name()){case "bottom":case "top":case "center":return a.left;case "left":return null}return a.left+a.shapeRadius}).right(function(){var a=this.scene.target[this.index];return"left"==this.name()?a.right+a.shapeRadius:null}).top(function(){var a=this.scene.target[this.index];switch(this.name()){case "left":case "right":case "center":return a.top;case "top":return null}return a.top+
a.shapeRadius}).bottom(function(){var a=this.scene.target[this.index];return"top"==this.name()?a.bottom+a.shapeRadius:null}).textAlign(function(){switch(this.name()){case "left":return"right";case "bottom":case "top":case "center":return"center"}return"left"}).textBaseline(function(){switch(this.name()){case "right":case "left":case "center":return"middle";case "bottom":return"top"}return"bottom"})};
pv.Dot.prototype.buildImplied=function(a){var b=a.shapeRadius,c=a.shapeSize;null==b?null==c?(a.shapeSize=20.25,a.shapeRadius=4.5):a.shapeRadius=Math.sqrt(c):null==c&&(a.shapeSize=b*b);pv.Mark.prototype.buildImplied.call(this,a)};pv.Label=function(){pv.Mark.call(this)};
pv.Label.prototype=pv.extend(pv.Mark).property("text",String).property("font",String).property("textAngle",Number).property("textStyle",pv.color).property("textAlign",String).property("textBaseline",String).property("textMargin",Number).property("textDecoration",String).property("textShadow",String);pv.Label.prototype.type="label";pv.Label.prototype.defaults=(new pv.Label).extend(pv.Mark.prototype.defaults).events("none").text(pv.identity).font("10px sans-serif").textAngle(0).textStyle("black").textAlign("left").textBaseline("bottom").textMargin(3);
pv.Line=function(){pv.Mark.call(this)};pv.Line.prototype=pv.extend(pv.Mark).property("lineWidth",Number).property("lineJoin",String).property("strokeStyle",pv.fillStyle).property("strokeDasharray",String).property("fillStyle",pv.fillStyle).property("segmented",Boolean).property("interpolate",String).property("eccentricity",Number).property("tension",Number);pv.Line.prototype.type="line";pv.Line.prototype.defaults=(new pv.Line).extend(pv.Mark.prototype.defaults).lineJoin("miter").lineWidth(1.5).strokeStyle(pv.Colors.category10().by(pv.parent)).strokeDasharray("").interpolate("linear").eccentricity(0).tension(0.7);
pv.Line.prototype.bind=pv.Area.prototype.bind;pv.Line.prototype.buildInstance=pv.Area.prototype.buildInstance;pv.Line.prototype.anchor=function(a){return pv.Area.prototype.anchor.call(this,a).textAlign(function(){switch(this.name()){case "left":return"right";case "bottom":case "top":case "center":return"center";case "right":return"left"}}).textBaseline(function(){switch(this.name()){case "right":case "left":case "center":return"middle";case "top":return"bottom";case "bottom":return"top"}})};
pv.Rule=function(){pv.Mark.call(this)};pv.Rule.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.fillStyle).property("strokeDasharray",String);pv.Rule.prototype.type="rule";pv.Rule.prototype.defaults=(new pv.Rule).extend(pv.Mark.prototype.defaults).lineWidth(1).strokeStyle("black").strokeDasharray("").antialias(!1);pv.Rule.prototype.anchor=pv.Line.prototype.anchor;
pv.Rule.prototype.buildImplied=function(a){var b=a.left,c=a.right;null!=a.width||null==b&&null==c||null!=c&&null!=b?a.height=0:a.width=0;pv.Mark.prototype.buildImplied.call(this,a)};pv.Panel=function(){pv.Bar.call(this);this.children=[];this.root=this;this.$dom=pv.$&&pv.$.s};pv.Panel.prototype=pv.extend(pv.Bar).property("transform").property("overflow",String).property("canvas",function(a){return"string"==typeof a?document.getElementById(a):a});pv.Panel.prototype.type="panel";
pv.Panel.prototype.defaults=(new pv.Panel).extend(pv.Bar.prototype.defaults).fillStyle(null).overflow("visible");pv.Panel.prototype.anchor=function(a){a=pv.Bar.prototype.anchor.call(this,a);a.parent=this;return a};pv.Panel.prototype.add=function(a){a=new a;a.parent=this;a.root=this.root;a.childIndex=this.children.length;this.children.push(a);return a};pv.Panel.prototype.bind=function(){pv.Mark.prototype.bind.call(this);for(var a=0;a<this.children.length;a++)this.children[a].bind()};
pv.Panel.prototype.buildInstance=function(a){pv.Bar.prototype.buildInstance.call(this,a);if(a.visible){a.children||(a.children=[]);var b=this.scale*a.transform.k,c,d=this.children.length;pv.Mark.prototype.index=-1;for(var e=0;e<d;e++)c=this.children[e],c.scene=a.children[e],c.scale=b,c.build();for(e=0;e<d;e++)c=this.children[e],a.children[e]=c.scene,delete c.scene,delete c.scale;a.children.length=d}};
pv.Panel.prototype.buildImplied=function(a){if(!this.parent){var b=a.canvas;if("batik"===pv.renderer())if(b){if(b.$panel!=this)for(b.$panel=this;b.lastChild;)b.removeChild(b.lastChild)}else b=document.lastChild;else if(b){if(b.$panel!=this)for(b.$panel=this;b.lastChild;)b.removeChild(b.lastChild);var c;null==a.width&&(c=parseFloat(pv.css(b,"width")),a.width=c-a.left-a.right);null==a.height&&(c=parseFloat(pv.css(b,"height")),a.height=c-a.top-a.bottom)}else if(c=this.$canvas||(this.$canvas=[]),!(b=
c[this.index]))if(b=c[this.index]=document.createElement("svgweb"==pv.renderer()?"div":"span"),this.$dom)this.$dom.parentNode.insertBefore(b,this.$dom);else{for(c=document.body;c.lastChild&&c.lastChild.tagName;)c=c.lastChild;c!=document.body&&(c=c.parentNode);c.appendChild(b)}a.canvas=b}a.transform||(a.transform=pv.Transform.identity);pv.Mark.prototype.buildImplied.call(this,a)};pv.Image=function(){pv.Bar.call(this)};
pv.Image.prototype=pv.extend(pv.Bar).property("url",String).property("imageWidth",Number).property("imageHeight",Number);pv.Image.prototype.type="image";pv.Image.prototype.defaults=(new pv.Image).extend(pv.Bar.prototype.defaults).fillStyle(null);pv.Image.prototype.image=function(a){this.$image=function(){var b=a.apply(this,arguments);return null==b?pv.Color.transparent:"string"==typeof b?pv.color(b):b};return this};
pv.Image.prototype.bind=function(){pv.Bar.prototype.bind.call(this);var a=this.binds,b=this;do a.image=b.$image;while(!a.image&&(b=b.proto))};
pv.Image.prototype.buildImplied=function(a){pv.Bar.prototype.buildImplied.call(this,a);if(a.visible&&(null==a.imageWidth&&(a.imageWidth=a.width),null==a.imageHeight&&(a.imageHeight=a.height),null==a.url&&this.binds.image)){var b=this.$canvas||(this.$canvas=document.createElement("canvas")),c=b.getContext("2d"),d=a.imageWidth,e=a.imageHeight,f=pv.Mark.stack;b.width=d;b.height=e;a=(a.image=c.createImageData(d,e)).data;f.unshift(null,null);for(c=b=0;b<e;b++){f[1]=b;for(var g=0;g<d;g++){f[0]=g;var h=
this.binds.image.apply(this,f);a[c++]=h.r;a[c++]=h.g;a[c++]=h.b;a[c++]=255*h.a}}f.splice(0,2)}};pv.Wedge=function(){pv.Mark.call(this)};pv.Wedge.prototype=pv.extend(pv.Mark).property("startAngle",Number).property("endAngle",Number).property("angle",Number).property("innerRadius",Number).property("outerRadius",Number).property("lineWidth",Number).property("strokeStyle",pv.fillStyle).property("fillStyle",pv.fillStyle);pv.Wedge.prototype.type="wedge";
pv.Wedge.prototype.defaults=(new pv.Wedge).extend(pv.Mark.prototype.defaults).startAngle(function(){var a=this.sibling();return a?a.endAngle:-Math.PI/2}).innerRadius(0).lineWidth(1.5).strokeStyle(null).fillStyle(pv.Colors.category20().by(pv.index));pv.Wedge.prototype.midRadius=function(){return(this.innerRadius()+this.outerRadius())/2};pv.Wedge.prototype.midAngle=function(){return(this.startAngle()+this.endAngle())/2};
pv.Wedge.prototype.anchor=function(a){function b(a){return a.innerRadius||a.angle<2*Math.PI}function c(a){return(a.innerRadius+a.outerRadius)/2}function d(a){return(a.startAngle+a.endAngle)/2}return pv.Mark.prototype.anchor.call(this,a).left(function(){var a=this.scene.target[this.index];if(b(a))switch(this.name()){case "outer":return a.left+a.outerRadius*Math.cos(d(a));case "inner":return a.left+a.innerRadius*Math.cos(d(a));case "start":return a.left+c(a)*Math.cos(a.startAngle);case "center":return a.left+
c(a)*Math.cos(d(a));case "end":return a.left+c(a)*Math.cos(a.endAngle)}return a.left}).top(function(){var a=this.scene.target[this.index];if(b(a))switch(this.name()){case "outer":return a.top+a.outerRadius*Math.sin(d(a));case "inner":return a.top+a.innerRadius*Math.sin(d(a));case "start":return a.top+c(a)*Math.sin(a.startAngle);case "center":return a.top+c(a)*Math.sin(d(a));case "end":return a.top+c(a)*Math.sin(a.endAngle)}return a.top}).textAlign(function(){var a=this.scene.target[this.index];if(b(a))switch(this.name()){case "outer":return pv.Wedge.upright(d(a))?
"right":"left";case "inner":return pv.Wedge.upright(d(a))?"left":"right"}return"center"}).textBaseline(function(){var a=this.scene.target[this.index];if(b(a))switch(this.name()){case "start":return pv.Wedge.upright(a.startAngle)?"top":"bottom";case "end":return pv.Wedge.upright(a.endAngle)?"bottom":"top"}return"middle"}).textAngle(function(){var a=this.scene.target[this.index],c=0;if(b(a))switch(this.name()){case "center":case "inner":case "outer":c=d(a);break;case "start":c=a.startAngle;break;case "end":c=
a.endAngle}return pv.Wedge.upright(c)?c:c+Math.PI})};pv.Wedge.upright=function(a){a%=2*Math.PI;a=0>a?2*Math.PI+a:a;return a<Math.PI/2||a>=3*Math.PI/2};pv.Wedge.prototype.buildImplied=function(a){null==a.angle?a.angle=a.endAngle-a.startAngle:null==a.endAngle&&(a.endAngle=a.startAngle+a.angle);pv.Mark.prototype.buildImplied.call(this,a)};
pv.Ease=function(){function a(a){return function(b){return 1-a(1-b)}}function b(a){return function(b){return 0.5*(0.5>b?a(2*b):2-a(2-2*b))}}function c(a){return function(b){return 0>b?0:1<b?1:Math.pow(b,a)}}function d(a){return 1-Math.cos(a*Math.PI/2)}function e(a){return a?Math.pow(2,10*(a-1))-0.0010:0}function f(a){return-(Math.sqrt(1-a*a)-1)}function g(a,b){var c;b||(b=0.45);!a||1>a?(a=1,c=b/4):c=b/(2*Math.PI)*Math.asin(1/a);return function(d){return 0>=d||1<=d?d:-(a*Math.pow(2,10*--d)*Math.sin((d-
c)*2*Math.PI/b))}}function h(a){a||(a=1.70158);return function(b){return b*b*((a+1)*b-a)}}function i(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+0.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+0.9375:7.5625*(a-=2.625/2.75)*a+0.984375}var j=c(2),k=c(3),l=g(),m=h(),s={linear:pv.identity,"quad-in":j,"quad-out":a(j),"quad-in-out":b(j),"quad-out-in":b(a(j)),"cubic-in":k,"cubic-out":a(k),"cubic-in-out":b(k),"cubic-out-in":b(a(k)),"sin-in":d,"sin-out":a(d),"sin-in-out":b(d),"sin-out-in":b(a(d)),
"exp-in":e,"exp-out":a(e),"exp-in-out":b(e),"exp-out-in":b(a(e)),"circle-in":f,"circle-out":a(f),"circle-in-out":b(f),"circle-out-in":b(a(f)),"elastic-in":l,"elastic-out":a(l),"elastic-in-out":b(l),"elastic-out-in":b(a(l)),"back-in":m,"back-out":a(m),"back-in-out":b(m),"back-out-in":b(a(m)),"bounce-in":i,"bounce-out":a(i),"bounce-in-out":b(i),"bounce-out-in":b(a(i))};pv.ease=function(a){return s[a]};return{reverse:a,reflect:b,linear:function(){return pv.identity},sin:function(){return d},exp:function(){return e},
circle:function(){return f},elastic:g,back:h,bounce:i,poly:c}}();
pv.Transition=function(a){function b(a){for(var b={},c=0;c<a.length;c++){var d=a[c];d.id&&(b[d.id]=d)}return b}function c(a,b,c,d){var e;if(b in s){var f=pv.Scale.interpolator(c[b],d[b]);e=function(a){c[b]=f(a)}}else e=function(a){0.5<a&&(c[b]=d[b])};e.next=a.head;a.head=e}function d(a,b,d){for(var f in b)"children"!=f&&b[f]!=d[f]&&c(a,f,b,d);if(b.children)for(f=0;f<b.children.length;f++)e(a,b.children[f],d.children[f])}function e(a,c,e){for(var g=c.mark,h=b(c),i=b(e),j=0;j<c.length;j++){var k=c[j],
l=k.id?i[k.id]:e[j];k.index=j;if(k.visible){if(!l||!l.visible){var s=f(c,j,g.$exit,e);k.transition=l?2:(e.push(s),1);l=s}d(a,k,l)}}for(j=0;j<e.length;j++)if(l=e[j],k=l.id?h[l.id]:c[j],(!k||!k.visible)&&l.visible)s=f(e,j,g.$enter,c),k?c[k.index]=s:c.push(s),d(a,s,l)}function f(a,b,c,d){var e=pv.extend(a[b]),f=a.mark,g=f.root.scene,h=(c||x).$properties,i;if(d.target&&(i=d.target[d.length]))a=pv.extend(a),a.target=pv.extend(d.target),a.target[b]=i;for(var j={},c=0;c<h.length;c++)j[h[c].name]=1;h=f.binds.optional.filter(function(a){return!(a.name in
j)}).concat(h);f.context(a,b,function(){this.buildProperties(e,h);this.buildImplied(e)});f.root.scene=g;return e}function g(a){for(var b=0,c=0;b<a.length;b++){var d=a[b];1!=d.transition&&(a[c++]=d,2==d.transition&&(d.visible=!1),d.children&&d.children.forEach(g))}a.length=c}function h(){if(m){var a=m;m=null;a()}}var i=this,j=pv.ease("cubic-in-out"),k=250,l,m,s={top:1,left:1,right:1,bottom:1,width:1,height:1,innerRadius:1,outerRadius:1,radius:1,startAngle:1,endAngle:1,angle:1,fillStyle:1,strokeStyle:1,
lineWidth:1,eccentricity:1,tension:1,textAngle:1,textStyle:1,textMargin:1},x=new pv.Transient;i.ease=function(a){return arguments.length?(j="function"==typeof a?a:pv.ease(a),i):j};i.duration=function(a){return arguments.length?(k=Number(a),i):k};i.start=function(b){m=b;a.parent&&(h(),fail());a.$transition&&a.$transition.stop();a.$transition=i;var b=pv.Mark.prototype.index,c=a.scene,d;a.scene=null;a.bind();a.build();d=a.scene;a.scene=c;pv.Mark.prototype.index=b;var f=Date.now(),s={};e(s,c,d);l=setInterval(function(){for(var b=
Math.max(0,Math.min(1,(Date.now()-f)/k)),d=j(b),e=s.head;e;e=e.next)e(d);1==b&&(g(a.scene),i.stop());pv.Scene.updateAll(c)},24)};i.stop=function(){clearInterval(l);h()}};pv.Transient=function(a){pv.Mark.call(this);this.fillStyle(null).strokeStyle(null).textStyle(null);this.on=function(b){return a.on(b)}};pv.Transient.prototype=pv.extend(pv.Mark);pv.simulation=function(a){return new pv.Simulation(a)};pv.Simulation=function(a){for(var b=0;b<a.length;b++)this.particle(a[b])};
pv.Simulation.prototype.particle=function(a){a.next=this.particles;isNaN(a.px)&&(a.px=a.x);isNaN(a.py)&&(a.py=a.y);isNaN(a.fx)&&(a.fx=0);isNaN(a.fy)&&(a.fy=0);this.particles=a;return this};pv.Simulation.prototype.force=function(a){a.next=this.forces;this.forces=a;return this};pv.Simulation.prototype.constraint=function(a){a.next=this.constraints;this.constraints=a;return this};
pv.Simulation.prototype.stabilize=function(a){var b;arguments.length||(a=3);for(var c=0;c<a;c++){var d=new pv.Quadtree(this.particles);for(b=this.constraints;b;b=b.next)b.apply(this.particles,d)}for(b=this.particles;b;b=b.next)b.px=b.x,b.py=b.y;return this};
pv.Simulation.prototype.step=function(){var a;for(a=this.particles;a;a=a.next){var b=a.px,c=a.py;a.px=a.x;a.py=a.y;a.x+=a.vx=a.x-b+a.fx;a.y+=a.vy=a.y-c+a.fy}b=new pv.Quadtree(this.particles);for(a=this.constraints;a;a=a.next)a.apply(this.particles,b);for(a=this.particles;a;a=a.next)a.fx=a.fy=0;for(a=this.forces;a;a=a.next)a.apply(this.particles,b)};
pv.Quadtree=function(a){function b(a,b,d,e,f,g){if(!isNaN(b.x)&&!isNaN(b.y))if(a.leaf)if(a.p){if(!(0.01>Math.abs(a.p.x-b.x)+Math.abs(a.p.y-b.y))){var h=a.p;a.p=null;c(a,h,d,e,f,g)}c(a,b,d,e,f,g)}else a.p=b;else c(a,b,d,e,f,g)}function c(a,c,d,e,f,g){var h=0.5*(d+f),i=0.5*(e+g),q=c.x>=h,n=c.y>=i;a.leaf=!1;switch((n<<1)+q){case 0:a=a.c1||(a.c1=new pv.Quadtree.Node);break;case 1:a=a.c2||(a.c2=new pv.Quadtree.Node);break;case 2:a=a.c3||(a.c3=new pv.Quadtree.Node);break;case 3:a=a.c4||(a.c4=new pv.Quadtree.Node)}q?
d=h:f=h;n?e=i:g=i;b(a,c,d,e,f,g)}var d,e=Number.POSITIVE_INFINITY,f=e,g=Number.NEGATIVE_INFINITY,h=g;for(d=a;d;d=d.next)d.x<e&&(e=d.x),d.y<f&&(f=d.y),d.x>g&&(g=d.x),d.y>h&&(h=d.y);d=g-e;var i=h-f;d>i?h=f+d:g=e+i;this.xMin=e;this.yMin=f;this.xMax=g;this.yMax=h;this.root=new pv.Quadtree.Node;for(d=a;d;d=d.next)b(this.root,d,e,f,g,h)};pv.Quadtree.Node=function(){this.leaf=!0;this.p=this.c4=this.c3=this.c2=this.c1=null};pv.Force={};
pv.Force.charge=function(a){function b(c){function d(a){b(a);c.cn+=a.cn;e+=a.cn*a.cx;f+=a.cn*a.cy}var e=0,f=0;c.cn=0;c.leaf||(c.c1&&d(c.c1),c.c2&&d(c.c2),c.c3&&d(c.c3),c.c4&&d(c.c4));c.p&&(c.cn+=a,e+=a*c.p.x,f+=a*c.p.y);c.cx=e/c.cn;c.cy=f/c.cn}function c(b,d,f,i,s,x){var v=b.cx-d.x,u=b.cy-d.y,q=1/Math.sqrt(v*v+u*u);if(b.leaf&&b.p!=d||(s-f)*q<h)q<g||(q>e&&(q=e),b=b.cn*q*q*q,d.fx+=v*b,d.fy+=u*b);else if(!b.leaf){var n=0.5*(f+s),p=0.5*(i+x);b.c1&&c(b.c1,d,f,i,n,p);b.c2&&c(b.c2,d,n,i,s,p);b.c3&&c(b.c3,
d,f,p,n,x);b.c4&&c(b.c4,d,n,p,s,x);q<g||(q>e&&(q=e),b.p&&b.p!=d&&(b=a*q*q*q,d.fx+=v*b,d.fy+=u*b))}}var d=2,e=1/d,f=500,g=1/f,h=0.9,i={};arguments.length||(a=-40);i.constant=function(b){return arguments.length?(a=Number(b),i):a};i.domain=function(a,b){return arguments.length?(d=Number(a),e=1/d,f=Number(b),g=1/f,i):[d,f]};i.theta=function(a){return arguments.length?(h=Number(a),i):h};i.apply=function(a,d){b(d.root);for(var e=a;e;e=e.next)c(d.root,e,d.xMin,d.yMin,d.xMax,d.yMax)};return i};
pv.Force.drag=function(a){var b={};arguments.length||(a=0.1);b.constant=function(c){return arguments.length?(a=c,b):a};b.apply=function(b){if(a)for(;b;b=b.next)b.fx-=a*b.vx,b.fy-=a*b.vy};return b};
pv.Force.spring=function(a){var b=0.1,c=20,d,e,f={};arguments.length||(a=0.1);f.links=function(a){return arguments.length?(d=a,e=a.map(function(a){return 1/Math.sqrt(Math.max(a.sourceNode.linkDegree,a.targetNode.linkDegree))}),f):d};f.constant=function(b){return arguments.length?(a=Number(b),f):a};f.damping=function(a){return arguments.length?(b=Number(a),f):b};f.length=function(a){return arguments.length?(c=Number(a),f):c};f.apply=function(){for(var f=0;f<d.length;f++){var h=d[f].sourceNode,i=d[f].targetNode,
j=h.x-i.x,k=h.y-i.y,l=Math.sqrt(j*j+k*k),m=l?1/l:1,m=(a*e[f]*(l-c)+b*e[f]*(j*(h.vx-i.vx)+k*(h.vy-i.vy))*m)*m,j=-m*(l?j:0.01*(0.5-Math.random())),k=-m*(l?k:0.01*(0.5-Math.random()));h.fx+=j;h.fy+=k;i.fx-=j;i.fy-=k}};return f};pv.Constraint={};
pv.Constraint.collision=function(a){function b(c,i,l,m,s,x){if(!c.leaf){var v=0.5*(l+s),u=0.5*(m+x),q=u<h,n=v>e,p=v<g;u>f&&(c.c1&&n&&b(c.c1,i,l,m,v,u),c.c2&&p&&b(c.c2,i,v,m,s,u));q&&(c.c3&&n&&b(c.c3,i,l,u,v,x),c.c4&&p&&b(c.c4,i,v,u,s,x))}c.p&&c.p!=i&&(l=i.x-c.p.x,m=i.y-c.p.y,s=Math.sqrt(l*l+m*m),x=d+a(c.p),s<x&&(s=0.5*((s-x)/s),l*=s,m*=s,i.x-=l,i.y-=m,c.p.x+=l,c.p.y+=m))}var c=1,d,e,f,g,h,i={};arguments.length||(d=10);i.repeat=function(a){return arguments.length?(c=Number(a),i):c};i.apply=function(i,
k){var l,m,s=-Infinity;for(l=i;l;l=l.next)m=a(l),m>s&&(s=m);for(var x=0;x<c;x++)for(l=i;l;l=l.next)m=(d=a(l))+s,e=l.x-m,g=l.x+m,f=l.y-m,h=l.y+m,b(k.root,l,k.xMin,k.yMin,k.xMax,k.yMax)};return i};pv.Constraint.position=function(a){var b=1,c={};arguments.length||(a=function(a){return a.fix});c.alpha=function(a){return arguments.length?(b=Number(a),c):b};c.apply=function(c){for(;c;c=c.next){var e=a(c);e&&(c.x+=(e.x-c.x)*b,c.y+=(e.y-c.y)*b,c.fx=c.fy=c.vx=c.vy=0)}};return c};
pv.Constraint.bound=function(){var a={},b,c;a.x=function(a,c){return arguments.length?(b={min:Math.min(a,c),max:Math.max(a,c)},this):b};a.y=function(a,b){return arguments.length?(c={min:Math.min(a,b),max:Math.max(a,b)},this):c};a.apply=function(a){if(b)for(var e=a;e;e=e.next)e.x=e.x<b.min?b.min:e.x>b.max?b.max:e.x;if(c)for(e=a;e;e=e.next)e.y=e.y<c.min?c.min:e.y>c.max?c.max:e.y};return a};pv.Layout=function(){pv.Panel.call(this)};pv.Layout.prototype=pv.extend(pv.Panel);
pv.Layout.prototype.property=function(a,b){this.hasOwnProperty("properties")||(this.properties=pv.extend(this.properties));this.properties[a]=!0;this.propertyMethod(a,!1,pv.Mark.cast[a]=b);return this};
pv.Layout.Network=function(){pv.Layout.call(this);var a=this;this.$id=pv.id();(this.node=(new pv.Mark).data(function(){return a.nodes()}).strokeStyle("#1f77b4").fillStyle("#fff").left(function(a){return a.x}).top(function(a){return a.y})).parent=this;this.link=(new pv.Mark).extend(this.node).data(function(a){return[a.sourceNode,a.targetNode]}).fillStyle(null).lineWidth(function(a,c){return 1.5*c.linkValue}).strokeStyle("rgba(0,0,0,.2)");this.link.add=function(b){return a.add(pv.Panel).data(function(){return a.links()}).add(b).extend(this)};
(this.label=(new pv.Mark).extend(this.node).textMargin(7).textBaseline("middle").text(function(a){return a.nodeName||a.nodeValue}).textAngle(function(a){a=a.midAngle;return pv.Wedge.upright(a)?a:a+Math.PI}).textAlign(function(a){return pv.Wedge.upright(a.midAngle)?"left":"right"})).parent=this};
pv.Layout.Network.prototype=pv.extend(pv.Layout).property("nodes",function(a){return a.map(function(a,c){"object"!=typeof a&&(a={nodeValue:a});a.index=c;return a})}).property("links",function(a){return a.map(function(a){isNaN(a.linkValue)&&(a.linkValue=isNaN(a.value)?1:a.value);return a})});pv.Layout.Network.prototype.reset=function(){this.$id=pv.id();return this};pv.Layout.Network.prototype.buildProperties=function(a,b){(a.$id||0)<this.$id&&pv.Layout.prototype.buildProperties.call(this,a,b)};
pv.Layout.Network.prototype.buildImplied=function(a){pv.Layout.prototype.buildImplied.call(this,a);if(a.$id>=this.$id)return!0;a.$id=this.$id;a.nodes.forEach(function(a){a.linkDegree=0});a.links.forEach(function(b){var c=b.linkValue;(b.sourceNode||(b.sourceNode=a.nodes[b.source])).linkDegree+=c;(b.targetNode||(b.targetNode=a.nodes[b.target])).linkDegree+=c})};pv.Layout.Hierarchy=function(){pv.Layout.Network.call(this);this.link.strokeStyle("#ccc")};pv.Layout.Hierarchy.prototype=pv.extend(pv.Layout.Network);
pv.Layout.Hierarchy.prototype.buildImplied=function(a){a.links||(a.links=pv.Layout.Hierarchy.links.call(this));pv.Layout.Network.prototype.buildImplied.call(this,a)};pv.Layout.Hierarchy.links=function(){return this.nodes().filter(function(a){return a.parentNode}).map(function(a){return{sourceNode:a,targetNode:a.parentNode,linkValue:1}})};
pv.Layout.Hierarchy.NodeLink={buildImplied:function(a){function b(a){switch(e){case "left":return a.depth*g;case "right":return g-a.depth*g;case "top":return a.breadth*g;case "bottom":return g-a.breadth*g;case "radial":return g/2+(a.parentNode?a.depth*(j-i)+i:0)*Math.cos(a.midAngle)}}function c(a){switch(e){case "left":return a.breadth*h;case "right":return h-a.breadth*h;case "top":return a.depth*h;case "bottom":return h-a.depth*h;case "radial":return h/2+(a.parentNode?a.depth*(j-i)+i:0)*Math.sin(a.midAngle)}}
var d=a.nodes,e=a.orient,f=/^(top|bottom)$/.test(e),g=a.width,h=a.height;if("radial"==e){var i=a.innerRadius,j=a.outerRadius;null==i&&(i=0);null==j&&(j=Math.min(g,h)/2)}for(a=0;a<d.length;a++){var k=d[a];k.midAngle="radial"==e?k.parentNode?2*(k.breadth-0.25)*Math.PI:0:f?Math.PI/2:0;k.x=b(k);k.y=c(k);k.firstChild&&(k.midAngle+=Math.PI)}}};
pv.Layout.Hierarchy.Fill={constructor:function(){this.node.strokeStyle("#fff").fillStyle("#ccc").width(function(a){return a.dx}).height(function(a){return a.dy}).innerRadius(function(a){return a.innerRadius}).outerRadius(function(a){return a.outerRadius}).startAngle(function(a){return a.startAngle}).angle(function(a){return a.angle});this.label.textAlign("center").left(function(a){return a.x+a.dx/2}).top(function(a){return a.y+a.dy/2});delete this.link},buildImplied:function(a){function b(a){switch(e){case "left":return(a.minDepth+
i)/(1+i)*g;case "right":return(1-(a.maxDepth+i)/(1+i))*g;case "top":return a.minBreadth*g;case "bottom":return(1-a.maxBreadth)*g;case "radial":return g/2}}function c(a){switch(e){case "left":return a.minBreadth*h;case "right":return(1-a.maxBreadth)*h;case "top":return(a.minDepth+i)/(1+i)*h;case "bottom":return(1-(a.maxDepth+i)/(1+i))*h;case "radial":return h/2}}var d=a.nodes,e=a.orient,f=/^(top|bottom)$/.test(e),g=a.width,h=a.height,i=-d[0].minDepth;if("radial"==e){var j=a.innerRadius,k=a.outerRadius;
null==j&&(j=0);j&&(i*=2);null==k&&(k=Math.min(g,h)/2)}for(a=0;a<d.length;a++){var l=d[a];l.x=b(l);l.y=c(l);"radial"==e?(l.innerRadius=Math.max(0,(l.minDepth+i/2)/(1+i/2))*(k-j)+j,l.outerRadius=(l.maxDepth+i/2)/(1+i/2)*(k-j)+j,l.startAngle=2*(l.parentNode?l.minBreadth-0.25:0)*Math.PI,l.angle=2*(l.parentNode?l.maxBreadth-l.minBreadth:1)*Math.PI,l.midAngle=l.startAngle+l.angle/2):l.midAngle=f?-Math.PI/2:0;var m=l,s;a:{switch(e){case "left":case "right":s=(l.maxDepth-l.minDepth)/(1+i)*g;break a;case "top":case "bottom":s=
(l.maxBreadth-l.minBreadth)*g;break a;case "radial":s=l.parentNode?(l.innerRadius+l.outerRadius)*Math.cos(l.midAngle):0;break a}s=void 0}m.dx=s;m=l;a:{switch(e){case "left":case "right":l=(l.maxBreadth-l.minBreadth)*h;break a;case "top":case "bottom":l=(l.maxDepth-l.minDepth)/(1+i)*h;break a;case "radial":l=l.parentNode?(l.innerRadius+l.outerRadius)*Math.sin(l.midAngle):0;break a}l=void 0}m.dy=l}}};
pv.Layout.Grid=function(){pv.Layout.call(this);var a=this;(this.cell=(new pv.Mark).data(function(){return a.scene[a.index].$grid}).width(function(){return a.width()/a.cols()}).height(function(){return a.height()/a.rows()}).left(function(){return this.width()*(this.index%a.cols())}).top(function(){return this.height()*Math.floor(this.index/a.cols())})).parent=this};pv.Layout.Grid.prototype=pv.extend(pv.Layout).property("rows").property("cols");pv.Layout.Grid.prototype.defaults=(new pv.Layout.Grid).extend(pv.Layout.prototype.defaults).rows(1).cols(1);
pv.Layout.Grid.prototype.buildImplied=function(a){pv.Layout.prototype.buildImplied.call(this,a);var b=a.rows,c=a.cols;"object"==typeof c&&(b=pv.transpose(c));"object"==typeof b?(a.$grid=pv.blend(b),a.rows=b.length,a.cols=b[0]?b[0].length:0):a.$grid=pv.repeat([a.data],b*c)};
pv.Layout.Stack=function(){function a(a){return function(){return d[a](this.parent.index,this.index)}}pv.Layout.call(this);var b=this,c=function(){return null},d={t:c,l:c,r:c,b:c,w:c,h:c},e,f=b.buildImplied;this.buildImplied=function(a){f.call(this,a);var b=a.layers,i=b.length,j,k=a.orient,l=/^(top|bottom)\b/.test(k),m=this.parent[l?"height":"width"](),s=[],x=[],v=[],u=pv.Mark.stack,q={parent:{parent:this}};u.unshift(null);e=[];for(var n=0;n<i;n++){v[n]=[];x[n]=[];q.parent.index=n;u[0]=b[n];e[n]=
this.$values.apply(q.parent,u);n||(j=e[n].length);u.unshift(null);for(var p=0;p<j;p++)u[0]=e[n][p],q.index=p,n||(s[p]=this.$x.apply(q,u)),v[n][p]=this.$y.apply(q,u);u.shift()}u.shift();switch(a.order){case "inside-out":for(var w=v.map(function(a){return pv.max.index(a)}),q=pv.range(i).sort(function(a,b){return w[a]-w[b]}),b=v.map(function(a){return pv.sum(a)}),y=u=0,t=[],r=[],n=0;n<i;n++)p=q[n],u<y?(u+=b[p],t.push(p)):(y+=b[p],r.push(p));b=r.reverse().concat(t);break;case "reverse":b=pv.range(i-1,
-1,-1);break;default:b=pv.range(i)}switch(a.offset){case "silohouette":for(p=0;p<j;p++){for(n=q=0;n<i;n++)q+=v[n][p];x[b[0]][p]=(m-q)/2}break;case "wiggle":for(n=q=0;n<i;n++)q+=v[n][0];x[b[0]][0]=q=(m-q)/2;for(p=1;p<j;p++){u=m=0;y=s[p]-s[p-1];for(n=0;n<i;n++)m+=v[n][p];for(n=0;n<i;n++){t=(v[b[n]][p]-v[b[n]][p-1])/(2*y);for(a=0;a<n;a++)t+=(v[b[a]][p]-v[b[a]][p-1])/y;u+=t*v[b[n]][p]}x[b[0]][p]=q-=m?u/m*y:0}break;case "expand":for(p=0;p<j;p++){for(n=a=x[b[0]][p]=0;n<i;n++)a+=v[n][p];if(a){a=m/a;for(n=
0;n<i;n++)v[n][p]*=a}else{a=m/i;for(n=0;n<i;n++)v[n][p]=a}}break;default:for(p=0;p<j;p++)x[b[0]][p]=0}for(p=0;p<j;p++){q=x[b[0]][p];for(n=1;n<i;n++)q+=v[b[n-1]][p],x[b[n]][p]=q}var n=k.indexOf("-"),i=l?"h":"w",l=0>n?l?"l":"b":k.charAt(n+1),k=k.charAt(0),z;for(z in d)d[z]=c;d[l]=function(a,b){return s[b]};d[k]=function(a,b){return x[a][b]};d[i]=function(a,b){return v[a][b]}};this.layer=(new pv.Mark).data(function(){return e[this.parent.index]}).top(a("t")).left(a("l")).right(a("r")).bottom(a("b")).width(a("w")).height(a("h"));
this.layer.add=function(a){return b.add(pv.Panel).data(function(){return b.layers()}).add(a).extend(this)}};pv.Layout.Stack.prototype=pv.extend(pv.Layout).property("orient",String).property("offset",String).property("order",String).property("layers");pv.Layout.Stack.prototype.defaults=(new pv.Layout.Stack).extend(pv.Layout.prototype.defaults).orient("bottom-left").offset("zero").layers([[]]);pv.Layout.Stack.prototype.$x=pv.Layout.Stack.prototype.$y=function(){return 0};
pv.Layout.Stack.prototype.x=function(a){this.$x=pv.functor(a);return this};pv.Layout.Stack.prototype.y=function(a){this.$y=pv.functor(a);return this};pv.Layout.Stack.prototype.$values=pv.identity;pv.Layout.Stack.prototype.values=function(a){this.$values=pv.functor(a);return this};
pv.Layout.Band=function(){function a(a){return function(){return d[a](this.index,this.parent.index)}}pv.Layout.call(this);var b=this,c=b.buildImplied,d,e,f=(new pv.Mark).data(function(){return e[this.parent.index]}).top(a("t")).left(a("l")).right(a("r")).bottom(a("b")).width(a("w")).height(a("h"));this.buildImplied=function(a){c.call(this,a);d=Object.create(pv.Layout.Band.$baseItemProps);e=[];var b=a.layers,f=b.length;if(0<f){var g=a.orient,h=/^(top|bottom)\b/.test(g),s=this.parent[h?"height":"width"](),
b=this._readData(b,e,a),x=b.length;"reverse"===a.bandOrder&&b.reverse();if("reverse"===a.order){e.reverse();for(var v=0;v<x;v++)b[v].items.reverse()}switch(a.layout){case "grouped":this._calcGrouped(b,f,a);break;case "stacked":this._calcStacked(b,f,s,a)}this._bindItemProps(b,d,g,h)}};var g=this.item={end:this,add:function(a){return b.add(pv.Panel).data(function(){return b.layers()}).add(a).extend(f)},order:function(a){b.order(a);return this},w:function(a){b.$iw=pv.functor(a);return this},h:function(a){b.$ih=
pv.functor(a);return this},horizontalRatio:function(a){b.$ihorizRatio=pv.functor(a);return this},verticalMargin:function(a){b.$ivertiMargin=pv.functor(a);return this}},h=this.band={end:this,w:function(a){b.$bw=pv.functor(a);return this},x:function(a){b.$bx=pv.functor(a);return this},order:function(a){b.bandOrder(a);return this},differentialControl:function(a){b.$bDiffControl=pv.functor(a);return this}};this.band.item=g;this.item.band=h};
pv.Layout.Band.$baseItemProps=function(){var a=function(){return null};return{t:a,l:a,r:a,b:a,w:a,h:a}}();pv.Layout.Band.prototype=pv.extend(pv.Layout).property("orient",String).property("layout",String).property("layers").property("yZero",Number).property("verticalMode",String).property("horizontalMode",String).property("order",String).property("bandOrder",String);pv.Layout.Band.prototype.defaults=(new pv.Layout.Band).extend(pv.Layout.prototype.defaults).orient("bottom-left").layout("grouped").yZero(0).layers([[]]);
pv.Layout.Band.prototype.$bx=pv.Layout.Band.prototype.$bw=pv.Layout.Band.prototype.$bDiffControl=pv.Layout.Band.prototype.$iw=pv.Layout.Band.prototype.$ih=pv.Layout.Band.prototype.$ivertiMargin=pv.functor(0);pv.Layout.Band.prototype.$ihorizRatio=pv.functor(0.9);pv.Layout.Band.prototype.$values=pv.identity;pv.Layout.Band.prototype.values=function(a){this.$values=pv.functor(a);return this};
pv.Layout.prototype._readData=function(a,b,c){var d=a.length,e=[],f,g=pv.Mark.stack,h={parent:{parent:this}};g.unshift(null);for(var i=0;i<d;i++){h.parent.index=i;g[0]=a[i];var j=b[i]=this.$values.apply(h.parent,g);i||(f=j.length);g.unshift(null);for(var k=0;k<f;k++){g[0]=j[k];h.index=k;var l=e[k];l||(l=e[k]={horizRatio:this.$ihorizRatio.apply(h,g),vertiMargin:this.$ivertiMargin.apply(h,g),w:this.$bw.apply(h,g),x:this.$bx.apply(h,g),diffControl:this.$bDiffControl?this.$bDiffControl.apply(h,g):0,items:[]});
var m=this.$ih.apply(h,g);l.items[i]={y:c.yZero||0,x:0,w:this.$iw.apply(h,g),h:null!=m?Math.abs(m):m,dir:0>m?-1:1}}g.shift()}g.shift();return e};
pv.Layout.Band.prototype._calcGrouped=function(a,b,c){for(var d=0,e=a.length;d<e;d++){for(var f=a[d],g=f.items,h=f.w,i=f.horizRatio,j=0,k=0;k<b;k++)j+=g[k].w;1===b?i=1:0<i&&1>=i||(i=1);if(null==h)f.w=j/i;else if("expand"===c.horizontalMode){h*=i;if(j){j=h/j;for(k=0;k<b;k++)g[k].w*=j}else{j=h/b;for(k=0;k<b;k++)g[k].w=j}j=h}k=j/i;f=f.x-k/2;i=1<b?(k-j)/(b-1):0;for(k=0;k<b;k++)j=g[k],j.x=f,f+=j.w+i,0>j.dir&&(j.y-=j.h)}};
pv.Layout.Band.prototype._calcStacked=function(a,b,c,d){var e=a.length,f;if("expand"===d.verticalMode)for(var g=0;g<e;g++){f=a[g].items;for(var h=null,i=0,j=0;j<b;j++){var k=f[j];k.dir=1;k=k.h;null!=k&&(i++,h+=k)}if(i)if(h){h=c/h;for(j=0;j<b;j++)k=f[j].h,null!=k&&(f[j].h=k*h)}else{h=c/i;for(j=0;j<b;j++)k=f[j].h,null!=k&&(f[j].h=h)}}c=b=d.yZero;for(g=0;g<e;g++){f=a[g];d=f.x;j=f.diffControl;k=0>j;h=0<f.vertiMargin?f.vertiMargin:0;f=f.items;var i=this._layoutItemsOfDir(1,k,f,h,d,c),l;i.existsOtherDir&&
(l=this._layoutItemsOfDir(-1,k,f,h,d,c));j?1===Math.abs(j)&&(c=i.yOffset,l&&(c-=l.yOffset)):c=b}};pv.Layout.Band.prototype._layoutItemsOfDir=function(a,b,c,d,e,f){for(var g=!1,h=d/2,i=b?-a:a,j=0,k=c.length;j<k;j+=1){var l=c[b?k-j-1:j];if(l.dir===a){var m=l.h||0;0<i?(l.y=f+h,f+=m):(l.y=f-(m-h),f-=m);l.h-=d;l.x=e-l.w/2}else g=!0}return{existsOtherDir:g,yOffset:f}};
pv.Layout.Band.prototype._bindItemProps=function(a,b,c,d){var e=c.indexOf("-"),f=d?"h":"w",g=d?"w":"h",d=0>e?d?"l":"b":c.charAt(e+1),c=c.charAt(0);b[d]=function(b,c){return a[b].items[c].x};b[c]=function(b,c){return a[b].items[c].y};b[g]=function(b,c){return a[b].items[c].w};b[f]=function(b,c){return a[b].items[c].h||0}};
pv.Layout.Treemap=function(){pv.Layout.Hierarchy.call(this);this.node.strokeStyle("#fff").fillStyle("rgba(31, 119, 180, .25)").width(function(a){return a.dx}).height(function(a){return a.dy});this.label.visible(function(a){return!a.firstChild}).left(function(a){return a.x+a.dx/2}).top(function(a){return a.y+a.dy/2}).textAlign("center").textAngle(function(a){return a.dx>a.dy?0:-Math.PI/2});(this.leaf=(new pv.Mark).extend(this.node).fillStyle(null).strokeStyle(null).visible(function(a){return!a.firstChild})).parent=
this;delete this.link};pv.Layout.Treemap.prototype=pv.extend(pv.Layout.Hierarchy).property("round",Boolean).property("paddingLeft",Number).property("paddingRight",Number).property("paddingTop",Number).property("paddingBottom",Number).property("mode",String).property("order",String);pv.Layout.Treemap.prototype.defaults=(new pv.Layout.Treemap).extend(pv.Layout.Hierarchy.prototype.defaults).mode("squarify").order("ascending");pv.Layout.Treemap.prototype.padding=function(a){return this.paddingLeft(a).paddingRight(a).paddingTop(a).paddingBottom(a)};
pv.Layout.Treemap.prototype.$size=function(a){return Number(a.nodeValue)};pv.Layout.Treemap.prototype.size=function(a){this.$size=pv.functor(a);return this};
pv.Layout.Treemap.prototype.buildImplied=function(a){function b(a,b,c,d,e,f,g){for(var h=0,i=0;h<a.length;h++){var j=a[h];c?(j.x=d+i,j.y=e,i+=j.dx=l(f*j.size/b),j.dy=g):(j.x=d,j.y=e+i,j.dx=f,i+=j.dy=l(g*j.size/b))}j&&(c?j.dx+=f-i:j.dy+=g-i)}function c(a,c){function d(a){var c=n==t,g=pv.sum(a,k),h=t?l(g/t):0;b(a,g,c,e,f,c?n:h,c?h:p);c?(f+=h,p-=h):(e+=h,n-=h);t=Math.min(n,p);return c}var e=a.x+g,f=a.y+i,n=a.dx-g-h,p=a.dy-i-j;if("squarify"!=m)b(a.childNodes,a.size,"slice"==m?!0:"dice"==m?!1:c&1,e,f,
n,p);else{var w=[],y=Infinity,t=Math.min(n,p),r=n*p/a.size;if(!(0>=a.size)){a.visitBefore(function(a){a.size*=r});for(var z=a.childNodes.slice();z.length;){var A=z[z.length-1];if(A.size){w.push(A);for(var A=t,B=-Infinity,D=Infinity,E=0,C=0;C<w.length;C++){var F=w[C].size;F<D&&(D=F);F>B&&(B=F);E+=F}E*=E;A*=A;r=Math.max(A*B/E,E/(A*D));r<=y?(z.pop(),y=r):(w.pop(),d(w),w.length=0,y=Infinity)}else z.pop()}if(d(w))for(c=0;c<w.length;c++)w[c].dy+=p;else for(c=0;c<w.length;c++)w[c].dx+=n}}}if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,
a)){var d=this,e=a.nodes[0],f=pv.Mark.stack,g=a.paddingLeft,h=a.paddingRight,i=a.paddingTop,j=a.paddingBottom,k=function(a){return a.size},l=a.round?Math.round:Number,m=a.mode;f.unshift(null);e.visitAfter(function(a,b){a.depth=b;a.x=a.y=a.dx=a.dy=0;a.size=a.firstChild?pv.sum(a.childNodes,function(a){return a.size}):d.$size.apply(d,(f[0]=a,f))});f.shift();switch(a.order){case "ascending":e.sort(function(a,b){return a.size-b.size});break;case "descending":e.sort(function(a,b){return b.size-a.size});
break;case "reverse":e.reverse()}e.x=0;e.y=0;e.dx=a.width;e.dy=a.height;e.visitBefore(c)}};pv.Layout.Tree=function(){pv.Layout.Hierarchy.call(this)};pv.Layout.Tree.prototype=pv.extend(pv.Layout.Hierarchy).property("group",Number).property("breadth",Number).property("depth",Number).property("orient",String);pv.Layout.Tree.prototype.defaults=(new pv.Layout.Tree).extend(pv.Layout.Hierarchy.prototype.defaults).group(1).breadth(15).depth(60).orient("top");
pv.Layout.Tree.prototype.buildImplied=function(a){function b(a){var c,e,f;if(a.firstChild){c=a.firstChild;e=a.lastChild;for(var g=f=c;g;g=g.nextSibling){b(g);var h=g,i=h.previousSibling;if(i){for(var j=h,k=h,l=i,i=h.parentNode.firstChild,m=j.mod,z=k.mod,A=l.mod,B=i.mod,l=l.lastChild||l.thread,j=j.firstChild||j.thread;l&&j;){i=i.firstChild||i.thread;k=k.lastChild||k.thread;k.ancestor=h;var D=l.prelim+A-(j.prelim+m)+d(l.depth,!1);if(0<D){var E=l.ancestor.parentNode==h.parentNode?l.ancestor:f,C=h,F=
D,G=C.number-E.number;C.change-=F/G;C.shift+=F;E.change+=F/G;C.prelim+=F;C.mod+=F;m+=D;z+=D}A+=l.mod;m+=j.mod;B+=i.mod;z+=k.mod;l=l.lastChild||l.thread;j=j.firstChild||j.thread}l&&(!k.lastChild&&!k.thread)&&(k.thread=l,k.mod+=A-z);j&&(!i.firstChild&&!i.thread)&&(i.thread=j,i.mod+=m-B,f=h)}}h=g=0;for(f=a.lastChild;f;f=f.previousSibling)f.prelim+=g,f.mod+=g,h+=f.change,g+=f.shift+h;e=0.5*(c.prelim+e.prelim);(c=a.previousSibling)?(a.prelim=c.prelim+d(a.depth,!0),a.mod=a.prelim-e):a.prelim=e}else if(c=
a.previousSibling)a.prelim=c.prelim+d(a.depth,!0)}function c(a,b,d){a.breadth=a.prelim+b;b+=a.mod;for(a=a.firstChild;a;a=a.nextSibling)c(a,b,d)}function d(a,b){return(b?1:k+1)/("radial"==h?a:1)}function e(a){return"radial"==h?a.breadth/i:0}function f(a){switch(h){case "left":return a.depth;case "right":return l-a.depth;case "top":case "bottom":return a.breadth+l/2;case "radial":return l/2+a.depth*Math.cos(e(a))}}function g(a){switch(h){case "left":case "right":return a.breadth+m/2;case "top":return a.depth;
case "bottom":return m-a.depth;case "radial":return m/2+a.depth*Math.sin(e(a))}}if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,a)){var h=a.orient,i=a.depth,j=a.breadth,k=a.group,l=a.width,m=a.height,a=a.nodes[0];a.visitAfter(function(a,b){a.ancestor=a;a.prelim=0;a.mod=0;a.change=0;a.shift=0;a.number=a.previousSibling?a.previousSibling.number+1:0;a.depth=b});b(a);c(a,-a.prelim,0);a.visitAfter(function(a){a.breadth*=j;a.depth*=i;a.midAngle=e(a);a.x=f(a);a.y=g(a);a.firstChild&&(a.midAngle+=
Math.PI);delete a.breadth;delete a.depth;delete a.ancestor;delete a.prelim;delete a.mod;delete a.change;delete a.shift;delete a.number;delete a.thread})}};pv.Layout.Indent=function(){pv.Layout.Hierarchy.call(this);this.link.interpolate("step-after")};pv.Layout.Indent.prototype=pv.extend(pv.Layout.Hierarchy).property("depth",Number).property("breadth",Number);pv.Layout.Indent.prototype.defaults=(new pv.Layout.Indent).extend(pv.Layout.Hierarchy.prototype.defaults).depth(15).breadth(15);
pv.Layout.Indent.prototype.buildImplied=function(a){function b(a,h,i){a.x=e+i++*d;a.y=f+h++*c;a.midAngle=0;for(a=a.firstChild;a;a=a.nextSibling)h=b(a,h,i);return h}if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,a)){var c=a.breadth,d=a.depth,e=0,f=0;b(a.nodes[0],1,1)}};pv.Layout.Pack=function(){pv.Layout.Hierarchy.call(this);this.node.shapeRadius(function(a){return a.radius}).strokeStyle("rgb(31, 119, 180)").fillStyle("rgba(31, 119, 180, .25)");this.label.textAlign("center");delete this.link};
pv.Layout.Pack.prototype=pv.extend(pv.Layout.Hierarchy).property("spacing",Number).property("order",String);pv.Layout.Pack.prototype.defaults=(new pv.Layout.Pack).extend(pv.Layout.Hierarchy.prototype.defaults).spacing(1).order("ascending");pv.Layout.Pack.prototype.$radius=function(){return 1};pv.Layout.Pack.prototype.size=function(a){this.$radius="function"==typeof a?function(){return Math.sqrt(a.apply(this,arguments))}:(a=Math.sqrt(a),function(){return a});return this};
pv.Layout.Pack.prototype.buildImplied=function(a){function b(d){for(var e=[],d=d.firstChild;d;d=d.nextSibling)d.firstChild&&(d.radius=b(d)),d.n=d.p=d,e.push(d);switch(a.order){case "ascending":e.sort(function(a,b){return a.radius-b.radius});break;case "descending":e.sort(function(a,b){return b.radius-a.radius});break;case "reverse":e.reverse()}var f=function(a){i=Math.min(a.x-a.radius,i);j=Math.max(a.x+a.radius,j);q=Math.min(a.y-a.radius,q);n=Math.max(a.y+a.radius,n)},g=function(a,b){var c=a.n;a.n=
b;b.p=a;b.n=c;c.p=b},h=function(a,b){var c=b.x-a.x,d=b.y-a.y,e=a.radius+b.radius;return 0.0010<e*e-c*c-d*d},i=Infinity,j=-Infinity,q=Infinity,n=-Infinity,p,w,y,t,r;p=e[0];p.x=-p.radius;p.y=0;f(p);if(1<e.length&&(w=e[1],w.x=w.radius,w.y=0,f(w),2<e.length)){y=e[2];c(p,w,y);f(y);g(p,y);p.p=y;g(y,w);w=p.n;for(d=3;d<e.length;d++){c(p,w,y=e[d]);var z=0,A=1,B=1;for(t=w.n;t!=w;t=t.n,A++)if(h(t,y)){z=1;break}if(1==z)for(r=p.p;r!=t.p;r=r.p,B++)if(h(r,y)){B<A&&(z=-1,t=r);break}0==z?(g(p,y),w=y,f(y)):0<z?(w=
p,y=t,w.n=y,y.p=w,w=t,d--):0>z&&(p=t,y=w,p.n=y,y.p=p,p=t,d--)}}f=(i+j)/2;g=(q+n)/2;for(d=h=0;d<e.length;d++)t=e[d],t.x-=f,t.y-=g,h=Math.max(h,t.radius+Math.sqrt(t.x*t.x+t.y*t.y));return h+a.spacing}function c(a,b,c){var d=b.radius+c.radius,e=a.radius+c.radius,f=b.x-a.x,b=b.y-a.y,g=Math.sqrt(f*f+b*b),h=(e*e+g*g-d*d)/(2*e*g),d=Math.acos(h),h=h*e,e=Math.sin(d)*e,f=f/g,b=b/g;c.x=a.x+h*f+e*b;c.y=a.y+h*b-e*f}function d(a,b,c,e){for(var f=a.firstChild;f;f=f.nextSibling)f.x+=a.x,f.y+=a.y,d(f,b,c,e);a.x=b+
e*a.x;a.y=c+e*a.y;a.radius*=e}if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,a)){var e=a.nodes,f=e[0],g=pv.Mark.stack;g.unshift(null);for(var h=0,i=e.length;h<i;h++){var j=e[h];j.firstChild||(j.radius=this.$radius.apply(this,(g[0]=j,g)))}g.shift();f.x=0;f.y=0;f.radius=b(f);e=this.width();g=this.height();h=1/Math.max(2*f.radius/e,2*f.radius/g);d(f,e/2,g/2,h)}};pv.Layout.Force=function(){pv.Layout.Network.call(this);this.link.lineWidth(function(a,b){return 1.5*Math.sqrt(b.linkValue)});this.label.textAlign("center")};
pv.Layout.Force.prototype=pv.extend(pv.Layout.Network).property("bound",Boolean).property("iterations",Number).property("dragConstant",Number).property("chargeConstant",Number).property("chargeMinDistance",Number).property("chargeMaxDistance",Number).property("chargeTheta",Number).property("springConstant",Number).property("springDamping",Number).property("springLength",Number);pv.Layout.Force.prototype.defaults=(new pv.Layout.Force).extend(pv.Layout.Network.prototype.defaults).dragConstant(0.1).chargeConstant(-40).chargeMinDistance(2).chargeMaxDistance(500).chargeTheta(0.9).springConstant(0.1).springDamping(0.3).springLength(20);
pv.Layout.Force.prototype.buildImplied=function(a){function b(a){return a.fix?1:a.vx*a.vx+a.vy*a.vy}if(pv.Layout.Network.prototype.buildImplied.call(this,a)){if(a=a.$force)a.next=this.binds.$force,this.binds.$force=a}else{for(var c=this,d=a.nodes,e=a.links,f=a.iterations,g=a.width,h=a.height,i=0,j;i<d.length;i++)j=d[i],isNaN(j.x)&&(j.x=g/2+40*Math.random()-20),isNaN(j.y)&&(j.y=h/2+40*Math.random()-20);j=pv.simulation(d);j.force(pv.Force.drag(a.dragConstant));j.force(pv.Force.charge(a.chargeConstant).domain(a.chargeMinDistance,
a.chargeMaxDistance).theta(a.chargeTheta));j.force(pv.Force.spring(a.springConstant).damping(a.springDamping).length(a.springLength).links(e));j.constraint(pv.Constraint.position());a.bound&&j.constraint(pv.Constraint.bound().x(6,g-6).y(6,h-6));if(null==f)j.step(),j.step(),a.$force=this.binds.$force={next:this.binds.$force,nodes:d,min:1E-4*(e.length+1),sim:j},this.$timer||(this.$timer=setInterval(function(){for(var a=!1,d=c.binds.$force;d;d=d.next)pv.max(d.nodes,b)>d.min&&(d.sim.step(),a=!0);a&&c.render()},
42));else for(i=0;i<f;i++)j.step()}};pv.Layout.Cluster=function(){pv.Layout.Hierarchy.call(this);var a,b=this.buildImplied;this.buildImplied=function(c){b.call(this,c);a=/^(top|bottom)$/.test(c.orient)?"step-before":/^(left|right)$/.test(c.orient)?"step-after":"linear"};this.link.interpolate(function(){return a})};pv.Layout.Cluster.prototype=pv.extend(pv.Layout.Hierarchy).property("group",Number).property("orient",String).property("innerRadius",Number).property("outerRadius",Number);
pv.Layout.Cluster.prototype.defaults=(new pv.Layout.Cluster).extend(pv.Layout.Hierarchy.prototype.defaults).group(0).orient("top");
pv.Layout.Cluster.prototype.buildImplied=function(a){if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,a)){var b=a.nodes[0],c=a.group,d,e,f=0,g=0.5-c/2,h=void 0;b.visitAfter(function(a){a.firstChild?a.depth=1+pv.max(a.childNodes,function(a){return a.depth}):(c&&h!=a.parentNode&&(h=a.parentNode,f+=c),f++,a.depth=0)});d=1/f;e=1/b.depth;h=void 0;b.visitAfter(function(a){a.firstChild?a.breadth=pv.mean(a.childNodes,function(a){return a.breadth}):(c&&h!=a.parentNode&&(h=a.parentNode,g+=c),a.breadth=
d*g++);a.depth=1-a.depth*e});b.visitAfter(function(a){a.minBreadth=a.firstChild?a.firstChild.minBreadth:a.breadth-d/2;a.maxBreadth=a.firstChild?a.lastChild.maxBreadth:a.breadth+d/2});b.visitBefore(function(a){a.minDepth=a.parentNode?a.parentNode.maxDepth:0;a.maxDepth=a.parentNode?a.depth+b.depth:a.minDepth+2*b.depth});b.minDepth=-e;pv.Layout.Hierarchy.NodeLink.buildImplied.call(this,a)}};pv.Layout.Cluster.Fill=function(){pv.Layout.Cluster.call(this);pv.Layout.Hierarchy.Fill.constructor.call(this)};
pv.Layout.Cluster.Fill.prototype=pv.extend(pv.Layout.Cluster);pv.Layout.Cluster.Fill.prototype.buildImplied=function(a){pv.Layout.Cluster.prototype.buildImplied.call(this,a)||pv.Layout.Hierarchy.Fill.buildImplied.call(this,a)};pv.Layout.Partition=function(){pv.Layout.Hierarchy.call(this)};pv.Layout.Partition.prototype=pv.extend(pv.Layout.Hierarchy).property("order",String).property("orient",String).property("innerRadius",Number).property("outerRadius",Number);
pv.Layout.Partition.prototype.defaults=(new pv.Layout.Partition).extend(pv.Layout.Hierarchy.prototype.defaults).orient("top");pv.Layout.Partition.prototype.$size=function(){return 1};pv.Layout.Partition.prototype.size=function(a){this.$size=a;return this};
pv.Layout.Partition.prototype.buildImplied=function(a){if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,a)){var b=this,c=a.nodes[0],d=pv.Mark.stack,e=0;d.unshift(null);c.visitAfter(function(a,c){c>e&&(e=c);a.size=a.firstChild?pv.sum(a.childNodes,function(a){return a.size}):b.$size.apply(b,(d[0]=a,d))});d.shift();switch(a.order){case "ascending":c.sort(function(a,b){return a.size-b.size});break;case "descending":c.sort(function(a,b){return b.size-a.size})}var f=1/e;c.minBreadth=0;c.breadth=
0.5;c.maxBreadth=1;c.visitBefore(function(a){for(var b=a.minBreadth,c=a.maxBreadth-b,d=a.firstChild;d;d=d.nextSibling)d.minBreadth=b,d.maxBreadth=b+=d.size/a.size*c,d.breadth=(b+d.minBreadth)/2});c.visitAfter(function(a,b){a.minDepth=(b-1)*f;a.maxDepth=a.depth=b*f});pv.Layout.Hierarchy.NodeLink.buildImplied.call(this,a)}};pv.Layout.Partition.Fill=function(){pv.Layout.Partition.call(this);pv.Layout.Hierarchy.Fill.constructor.call(this)};pv.Layout.Partition.Fill.prototype=pv.extend(pv.Layout.Partition);
pv.Layout.Partition.Fill.prototype.buildImplied=function(a){pv.Layout.Partition.prototype.buildImplied.call(this,a)||pv.Layout.Hierarchy.Fill.buildImplied.call(this,a)};pv.Layout.Arc=function(){pv.Layout.Network.call(this);var a,b,c,d=this.buildImplied;this.buildImplied=function(e){d.call(this,e);b=e.directed;a="radial"==e.orient?"linear":"polar";c="right"==e.orient||"top"==e.orient};this.link.data(function(a){var d=a.sourceNode,a=a.targetNode;return c!=(b||d.breadth<a.breadth)?[d,a]:[a,d]}).interpolate(function(){return a})};
pv.Layout.Arc.prototype=pv.extend(pv.Layout.Network).property("orient",String).property("directed",Boolean);pv.Layout.Arc.prototype.defaults=(new pv.Layout.Arc).extend(pv.Layout.Network.prototype.defaults).orient("bottom");pv.Layout.Arc.prototype.sort=function(a){this.$sort=a;return this};
pv.Layout.Arc.prototype.buildImplied=function(a){function b(a){switch(f){case "top":return-Math.PI/2;case "bottom":return Math.PI/2;case "left":return Math.PI;case "right":return 0;case "radial":return 2*(a-0.25)*Math.PI}}function c(a){switch(f){case "top":case "bottom":return a*i;case "left":return 0;case "right":return i;case "radial":return i/2+k*Math.cos(b(a))}}function d(a){switch(f){case "top":return 0;case "bottom":return j;case "left":case "right":return a*j;case "radial":return j/2+k*Math.sin(b(a))}}
if(!pv.Layout.Network.prototype.buildImplied.call(this,a)){var e=a.nodes,f=a.orient,g=this.$sort,h=pv.range(e.length),i=a.width,j=a.height,k=Math.min(i,j)/2;g&&h.sort(function(a,b){return g(e[a],e[b])});for(a=0;a<e.length;a++){var l=e[h[a]],m=l.breadth=(a+0.5)/e.length;l.x=c(m);l.y=d(m);l.midAngle=b(m)}}};
pv.Layout.Horizon=function(){pv.Layout.call(this);var a=this,b,c,d,e,f,g,h=this.buildImplied;this.buildImplied=function(a){h.call(this,a);b=a.bands;c=a.mode;d=Math.round(("color"==c?0.5:1)*a.height);e=a.backgroundStyle;f=pv.ramp(e,a.negativeStyle).domain(0,b);g=pv.ramp(e,a.positiveStyle).domain(0,b)};b=(new pv.Panel).data(function(){return pv.range(2*b)}).overflow("hidden").height(function(){return d}).top(function(a){return"color"==c?(a&1)*d:0}).fillStyle(function(a){return a?null:e});this.band=
(new pv.Mark).top(function(a,b){return"mirror"==c&&b&1?(b+1>>1)*d:null}).bottom(function(a,b){return"mirror"==c?b&1?null:(b+1>>1)*-d:(b&1||-1)*(b+1>>1)*d}).fillStyle(function(a,b){return(b&1?f:g)((b>>1)+1)});this.band.add=function(c){return a.add(pv.Panel).extend(b).add(c).extend(this)}};pv.Layout.Horizon.prototype=pv.extend(pv.Layout).property("bands",Number).property("mode",String).property("backgroundStyle",pv.color).property("positiveStyle",pv.color).property("negativeStyle",pv.color);
pv.Layout.Horizon.prototype.defaults=(new pv.Layout.Horizon).extend(pv.Layout.prototype.defaults).bands(2).mode("offset").backgroundStyle("white").positiveStyle("#1f77b4").negativeStyle("#d62728");
pv.Layout.Rollup=function(){pv.Layout.Network.call(this);var a=this,b,c,d=a.buildImplied;this.buildImplied=function(a){d.call(this,a);b=a.$rollup.nodes;c=a.$rollup.links};this.node.data(function(){return b}).shapeSize(function(a){return 20*a.nodes.length});this.link.interpolate("polar").eccentricity(0.8);this.link.add=function(b){return a.add(pv.Panel).data(function(){return c}).add(b).extend(this)}};pv.Layout.Rollup.prototype=pv.extend(pv.Layout.Network).property("directed",Boolean);
pv.Layout.Rollup.prototype.x=function(a){this.$x=pv.functor(a);return this};pv.Layout.Rollup.prototype.y=function(a){this.$y=pv.functor(a);return this};
pv.Layout.Rollup.prototype.buildImplied=function(a){if(!pv.Layout.Network.prototype.buildImplied.call(this,a)){var b=a.nodes,c=a.links,d=a.directed,e=b.length,f=[],g=[],h=0,i={},j={},k=pv.Mark.stack,l={parent:this};k.unshift(null);for(var m=0;m<e;m++)l.index=m,k[0]=b[m],f[m]=this.$x.apply(l,k),g[m]=this.$y.apply(l,k);k.shift();for(m=0;m<b.length;m++)e=f[m]+","+g[m],k=i[e],k||(k=i[e]=pv.extend(b[m]),k.index=h++,k.x=f[m],k.y=g[m],k.nodes=[]),k.nodes.push(b[m]);for(m=0;m<c.length;m++)b=c[m].sourceNode,
h=c[m].targetNode,b=i[f[b.index]+","+g[b.index]],h=i[f[h.index]+","+g[h.index]],e=!d&&b.index>h.index?h.index+","+b.index:b.index+","+h.index,(k=j[e])||(k=j[e]={sourceNode:b,targetNode:h,linkValue:0,links:[]}),k.links.push(c[m]),k.linkValue+=c[m].linkValue;a.$rollup={nodes:pv.values(i),links:pv.values(j)}}};
pv.Layout.Matrix=function(){pv.Layout.Network.call(this);var a,b,c,d,e,f=this.buildImplied;this.buildImplied=function(g){f.call(this,g);a=g.nodes.length;b=g.width/a;c=g.height/a;d=g.$matrix.labels;e=g.$matrix.pairs};this.link.data(function(){return e}).left(function(){return b*(this.index%a)}).top(function(){return c*Math.floor(this.index/a)}).width(function(){return b}).height(function(){return c}).lineWidth(1.5).strokeStyle("#fff").fillStyle(function(a){return a.linkValue?"#555":"#eee"}).parent=
this;delete this.link.add;this.label.data(function(){return d}).left(function(){return this.index&1?b*((this.index>>1)+0.5):0}).top(function(){return this.index&1?0:c*((this.index>>1)+0.5)}).textMargin(4).textAlign(function(){return this.index&1?"left":"right"}).textAngle(function(){return this.index&1?-Math.PI/2:0});delete this.node};pv.Layout.Matrix.prototype=pv.extend(pv.Layout.Network).property("directed",Boolean);pv.Layout.Matrix.prototype.sort=function(a){this.$sort=a;return this};
pv.Layout.Matrix.prototype.buildImplied=function(a){if(!pv.Layout.Network.prototype.buildImplied.call(this,a)){var b=a.nodes,c=a.links,d=this.$sort,e=b.length,f=pv.range(e),g=[],h=[],i={};a.$matrix={labels:g,pairs:h};d&&f.sort(function(a,c){return d(b[a],b[c])});for(var j=0;j<e;j++)for(var k=0;k<e;k++){var l=f[j],m=f[k];h.push(i[l+"."+m]={row:j,col:k,sourceNode:b[l],targetNode:b[m],linkValue:0})}for(j=0;j<e;j++)l=f[j],g.push(b[l],b[l]);for(j=0;j<c.length;j++)g=c[j],e=g.sourceNode.index,f=g.targetNode.index,
g=g.linkValue,i[e+"."+f].linkValue+=g,a.directed||(i[f+"."+e].linkValue+=g)}};
pv.Layout.Bullet=function(){pv.Layout.call(this);var a=this.buildImplied,b=this.x=pv.Scale.linear(),c,d,e,f,g;this.buildImplied=function(b){a.call(this,g=b);c=b.orient;d=/^left|right$/.test(c);e=pv.ramp("#bbb","#eee").domain(0,Math.max(1,g.ranges.length-1));f=pv.ramp("steelblue","lightsteelblue").domain(0,Math.max(1,g.measures.length-1))};(this.range=new pv.Mark).data(function(){return g.ranges}).reverse(!0).left(function(){return"left"==c?0:null}).top(function(){return"top"==c?0:null}).right(function(){return"right"==
c?0:null}).bottom(function(){return"bottom"==c?0:null}).width(function(a){return d?b(a):null}).height(function(a){return d?null:b(a)}).fillStyle(function(){return e(this.index)}).antialias(!1).parent=this;(this.measure=new pv.Mark).extend(this.range).data(function(){return g.measures}).left(function(){return"left"==c?0:d?null:this.parent.width()/3.25}).top(function(){return"top"==c?0:d?this.parent.height()/3.25:null}).right(function(){return"right"==c?0:d?null:this.parent.width()/3.25}).bottom(function(){return"bottom"==
c?0:d?this.parent.height()/3.25:null}).fillStyle(function(){return f(this.index)}).parent=this;(this.marker=new pv.Mark).data(function(){return g.markers}).left(function(a){return"left"==c?b(a):d?null:this.parent.width()/2}).top(function(a){return"top"==c?b(a):d?this.parent.height()/2:null}).right(function(a){return"right"==c?b(a):null}).bottom(function(a){return"bottom"==c?b(a):null}).strokeStyle("black").shape("bar").shapeAngle(function(){return d?0:Math.PI/2}).parent=this;(this.tick=new pv.Mark).data(function(){return b.ticks(7)}).left(function(a){return"left"==
c?b(a):null}).top(function(a){return"top"==c?b(a):null}).right(function(a){return"right"==c?b(a):d?null:-6}).bottom(function(a){return"bottom"==c?b(a):d?-8:null}).height(function(){return d?6:null}).width(function(){return d?null:6}).parent=this};pv.Layout.Bullet.prototype=pv.extend(pv.Layout).property("orient",String).property("ranges").property("markers").property("measures").property("maximum",Number);pv.Layout.Bullet.prototype.defaults=(new pv.Layout.Bullet).extend(pv.Layout.prototype.defaults).orient("left").ranges([]).markers([]).measures([]);
pv.Layout.Bullet.prototype.buildImplied=function(a){pv.Layout.prototype.buildImplied.call(this,a);var b=this.parent[/^left|right$/.test(a.orient)?"width":"height"]();a.maximum=a.maximum||pv.max([].concat(a.ranges,a.markers,a.measures));this.x.domain(0,a.maximum).range(0,b)};pv.Behavior={};
pv.Behavior.drag=function(){var a,b,c,d,e;pv.listen(window,"mousemove",function(f){a&&(a.mark.context(a,b,function(){var a=this.mouse();c.x=c.fix.x=Math.max(0,Math.min(d.x+a.x,e.x));c.y=c.fix.y=Math.max(0,Math.min(d.y+a.y,e.y));this.render()}),pv.Mark.dispatch("drag",a,b,f))});pv.listen(window,"mouseup",function(d){a&&(c.fix=null,a.mark.context(a,b,function(){this.render()}),pv.Mark.dispatch("dragend",a,b,d),a=null)});return function(f,g){b=this.index;a=this.scene;var h=this.mouse();d=((c=f).fix=
pv.vector(f.x,f.y)).minus(h);e={x:this.parent.width()-(f.dx||0),y:this.parent.height()-(f.dy||0)};a.mark.context(a,b,function(){this.render()});pv.Mark.dispatch("dragstart",a,b,g)}};
pv.Behavior.point=function(a){function b(a,c){for(var d=a[c],e={cost:Infinity},f=(d.visible?d.children.length:0)-1;0<=f;f--){var i=d.children[f],j=i.mark,q;if("panel"==j.type){j.scene=i;for(var n=i.length-1;0<=n;n--)j.index=n,q=b(i,n),q.cost<e.cost&&(e=q);delete j.scene;delete j.index}else if(j.$handlers.point){j=j.mouse();for(n=i.length-1;0<=n;n--){var p=i[n];q=j.x-p.left-(p.width||0)/2;var p=j.y-p.top-(p.height||0)/2,w=g*q*q+h*p*p;w<e.cost&&(e.distance=q*q+p*p,e.cost=w,e.scene=i,e.index=n)}}}return e}
function c(a){var c=b(this.scene,this.index);if(Infinity==c.cost||c.distance>j)c=null;if(e){if(c&&e.scene==c.scene&&e.index==c.index)return;pv.Mark.dispatch("unpoint",e.scene,e.index,a)}if(e=c)pv.Mark.dispatch("point",c.scene,c.index,a),!i&&"panel"===this.type?(i=this,i.event("mouseout",function(){d.call(i.scene.$g,arguments[arguments.length-1])})):pv.listen(this.root.canvas(),"mouseout",d)}function d(a){e&&!pv.ancestor(this,a.relatedTarget)&&(pv.Mark.dispatch("unpoint",e.scene,e.index,a),e=null)}
var e,f=null,g=1,h=1,i=null,j=arguments.length?a*a:900;c.collapse=function(a){if(arguments.length){f=String(a);switch(f){case "y":g=1;h=0;break;case "x":g=0;h=1;break;default:h=g=1}return c}return f};return c};
pv.Behavior.select=function(){var a,b,c,d;pv.listen(window,"mousemove",function(e){a&&(a.mark.context(a,b,function(){var a=this.mouse();c.x=Math.max(0,Math.min(d.x,a.x));c.y=Math.max(0,Math.min(d.y,a.y));c.dx=Math.min(this.width(),Math.max(a.x,d.x))-c.x;c.dy=Math.min(this.height(),Math.max(a.y,d.y))-c.y;this.render()}),pv.Mark.dispatch("select",a,b,e))});pv.listen(window,"mouseup",function(c){a&&(pv.Mark.dispatch("selectend",a,b,c),a=null)});return function(e,f){b=this.index;a=this.scene;d=this.mouse();
c=e;c.x=d.x;c.y=d.y;c.dx=c.dy=0;pv.Mark.dispatch("selectstart",a,b,f)}};
pv.Behavior.resize=function(a){var b,c,d,e;pv.listen(window,"mousemove",function(a){b&&(b.mark.context(b,c,function(){var a=this.mouse();d.x=Math.max(0,Math.min(e.x,a.x));d.y=Math.max(0,Math.min(e.y,a.y));d.dx=Math.min(this.parent.width(),Math.max(a.x,e.x))-d.x;d.dy=Math.min(this.parent.height(),Math.max(a.y,e.y))-d.y;this.render()}),pv.Mark.dispatch("resize",b,c,a))});pv.listen(window,"mouseup",function(a){b&&(pv.Mark.dispatch("resizeend",b,c,a),b=null)});return function(f,g){c=this.index;b=this.scene;
e=this.mouse();d=f;switch(a){case "left":e.x=d.x+d.dx;break;case "right":e.x=d.x;break;case "top":e.y=d.y+d.dy;break;case "bottom":e.y=d.y}pv.Mark.dispatch("resizestart",b,c,g)}};
pv.Behavior.pan=function(){function a(){c=this.index;b=this.scene;e=pv.vector(pv.event.pageX,pv.event.pageY);d=this.transform();f=1/(d.k*this.scale);g&&(g={x:(1-d.k)*this.width(),y:(1-d.k)*this.height()})}var b,c,d,e,f,g;a.bound=function(a){return arguments.length?(g=Boolean(a),this):Boolean(g)};pv.listen(window,"mousemove",function(a){b&&(b.mark.context(b,c,function(){var a=d.translate((pv.event.pageX-e.x)*f,(pv.event.pageY-e.y)*f);g&&(a.x=Math.max(g.x,Math.min(0,a.x)),a.y=Math.max(g.y,Math.min(0,
a.y)));this.transform(a).render()}),pv.Mark.dispatch("pan",b,c,a))});pv.listen(window,"mouseup",function(){b=null});return a};
pv.Behavior.zoom=function(a){function b(b){var e=this.mouse(),f=pv.event.wheel*a,e=this.transform().translate(e.x,e.y).scale(0>f?1E3/(1E3-f):(1E3+f)/1E3).translate(-e.x,-e.y);c&&(e.k=Math.max(1,e.k),e.x=Math.max((1-e.k)*this.width(),Math.min(0,e.x)),e.y=Math.max((1-e.k)*this.height(),Math.min(0,e.y)));this.transform(e).render();pv.Mark.dispatch("zoom",this.scene,this.index,b)}var c;arguments.length||(a=1/48);b.bound=function(a){return arguments.length?(c=Boolean(a),this):Boolean(c)};return b};
pv.Geo=function(){};
pv.Geo.projections={mercator:{project:function(a){return{x:a.lng/180,y:85<a.lat?1:-85>a.lat?-1:Math.log(Math.tan(Math.PI/4+pv.radians(a.lat)/2))/Math.PI}},invert:function(a){return{lng:180*a.x,lat:pv.degrees(2*Math.atan(Math.exp(a.y*Math.PI))-Math.PI/2)}}},"gall-peters":{project:function(a){return{x:a.lng/180,y:Math.sin(pv.radians(a.lat))}},invert:function(a){return{lng:180*a.x,lat:pv.degrees(Math.asin(a.y))}}},sinusoidal:{project:function(a){return{x:pv.radians(a.lng)*Math.cos(pv.radians(a.lat))/Math.PI,
y:a.lat/90}},invert:function(a){return{lng:pv.degrees(a.x*Math.PI/Math.cos(a.y*Math.PI/2)),lat:90*a.y}}},aitoff:{project:function(a){var b=pv.radians(a.lng),a=pv.radians(a.lat),c=Math.acos(Math.cos(a)*Math.cos(b/2));return{x:2*(c?Math.cos(a)*Math.sin(b/2)*c/Math.sin(c):0)/Math.PI,y:2*(c?Math.sin(a)*c/Math.sin(c):0)/Math.PI}},invert:function(a){var b=a.y*Math.PI/2;return{lng:pv.degrees(a.x*Math.PI/2/Math.cos(b)),lat:pv.degrees(b)}}},hammer:{project:function(a){var b=pv.radians(a.lng),a=pv.radians(a.lat),
c=Math.sqrt(1+Math.cos(a)*Math.cos(b/2));return{x:2*Math.SQRT2*Math.cos(a)*Math.sin(b/2)/c/3,y:Math.SQRT2*Math.sin(a)/c/1.5}},invert:function(a){var b=3*a.x,a=1.5*a.y,c=Math.sqrt(1-b*b/16-a*a/4);return{lng:pv.degrees(2*Math.atan2(c*b,2*(2*c*c-1))),lat:pv.degrees(Math.asin(c*a))}}},identity:{project:function(a){return{x:a.lng/180,y:a.lat/90}},invert:function(a){return{lng:180*a.x,lat:90*a.y}}}};
pv.Geo.scale=function(a){function b(a){if(!k||a.lng!=k.lng||a.lat!=k.lat)k=a,a=c(a),l={x:h(a.x),y:i(a.y)};return l}function c(a){return g.project({lng:a.lng-j.lng,lat:a.lat})}var d={x:0,y:0},e={x:1,y:1},f=[],g=pv.Geo.projections.identity,h=pv.Scale.linear(-1,1).range(0,1),i=pv.Scale.linear(-1,1).range(1,0),j={lng:0,lat:0},k,l;b.x=function(a){return b(a).x};b.y=function(a){return b(a).y};b.ticks={lng:function(a){var b;if(1<f.length){var c=pv.Scale.linear();void 0==a&&(a=10);b=c.domain(f,function(a){return a.lat}).ticks(a);
a=c.domain(f,function(a){return a.lng}).ticks(a)}else b=pv.range(-80,81,10),a=pv.range(-180,181,10);return a.map(function(a){return b.map(function(b){return{lat:b,lng:a}})})},lat:function(a){return pv.transpose(b.ticks.lng(a))}};b.invert=function(a){a={x:h.invert(a.x),y:i.invert(a.y)};a=g.invert(a);a.lng+=j.lng;return a};b.domain=function(a,b){if(arguments.length){f=a instanceof Array?1<arguments.length?pv.map(a,b):a:Array.prototype.slice.call(arguments);if(1<f.length){var d=f.map(function(a){return a.lng}),
e=f.map(function(a){return a.lat});j={lng:(pv.max(d)+pv.min(d))/2,lat:(pv.max(e)+pv.min(e))/2};d=f.map(c);h.domain(d,function(a){return a.x});i.domain(d,function(a){return a.y})}else j={lng:0,lat:0},h.domain(-1,1),i.domain(-1,1);k=null;return this}return f};b.range=function(a,b){return arguments.length?("object"==typeof a?(d={x:Number(a.x),y:Number(a.y)},e={x:Number(b.x),y:Number(b.y)}):(d={x:0,y:0},e={x:Number(a),y:Number(b)}),h.range(d.x,e.x),i.range(e.y,d.y),k=null,this):[d,e]};b.projection=function(a){return arguments.length?
(g="string"==typeof a?pv.Geo.projections[a]||pv.Geo.projections.identity:a,this.domain(f)):a};b.by=function(a){function c(){return b(a.apply(this,arguments))}for(var d in b)c[d]=b[d];return c};arguments.length&&b.projection(a);return b};
